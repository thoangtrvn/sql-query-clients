
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>cloud_utilities.sql_query &#8212; SQLClient alpha documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/js/custom.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">SQLClient</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../includeme.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utilities.html">ibmcloudsql.utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cos.html">ibmcloudsql.cos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sql_magic.html">ibmcloudsql.sql_magic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sql_query.html">ibmcloudsql.sql_query</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">ibmcloudsql</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for cloud_utilities.sql_query</h1><div class="highlight"><pre>
<span></span><span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># Copyright IBM Corp. 2020</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">ibmcloudsql</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">dateutil.parser</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pformat</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">exceptions</span> <span class="kn">import</span> <span class="n">MaxRequestError</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">MaxRequestError</span>
<span class="kn">from</span> <span class="nn">requests.exceptions</span> <span class="kn">import</span> <span class="n">HTTPError</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.cos</span> <span class="kn">import</span> <span class="n">COSClient</span><span class="p">,</span> <span class="n">ParsedUrl</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">cos</span> <span class="kn">import</span> <span class="n">COSClient</span><span class="p">,</span> <span class="n">ParsedUrl</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.utilities</span> <span class="kn">import</span> <span class="n">rename_keys</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">utilities</span> <span class="kn">import</span> <span class="n">rename_keys</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sql_magic</span> <span class="kn">import</span> <span class="n">SQLMagic</span><span class="p">,</span> <span class="n">format_sql</span><span class="p">,</span> <span class="n">print_sql</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.sql_magic</span> <span class="kn">import</span> <span class="n">SQLMagic</span><span class="p">,</span> <span class="n">format_sql</span><span class="p">,</span> <span class="n">print_sql</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.hive_table</span> <span class="kn">import</span> <span class="n">HIVETable</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">hive_table</span> <span class="kn">import</span> <span class="n">HIVETable</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">JSONDecodeError</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">sqlparse</span>
<span class="kn">import</span> <span class="nn">os</span>


<div class="viewcode-block" id="check_saved_jobs_decorator"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.check_saved_jobs_decorator">[docs]</a><span class="k">def</span> <span class="nf">check_saved_jobs_decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;a decorator that load data from ProjectLib, check for completed SQL Query job, before deciding to launch it&quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getcallargs</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span>
            <span class="s1">&#39;prefix&#39;</span><span class="p">]</span>  <span class="c1"># Gets you the username, default or modifed</span>
        <span class="n">sql_stmt</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;sql_stmt&quot;</span><span class="p">]</span>
        <span class="c1"># refine query</span>
        <span class="n">sql_stmt</span> <span class="o">=</span> <span class="n">format_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>

        <span class="n">run_as_usual</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># handle here</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_project_lib_data</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
                <span class="n">keys_mapping</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="c1"># refine existing data</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">new_key</span> <span class="o">=</span> <span class="n">format_sql</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">new_key</span><span class="p">:</span>
                        <span class="n">keys_mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_key</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_mapping</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rename_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">keys_mapping</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sql_stmt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">run_as_usual</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sql_stmt</span><span class="p">][</span><span class="s2">&quot;job_id&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sql_stmt</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Job </span><span class="si">{}</span><span class="s2"> completed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># query the status</span>
                    <span class="n">job_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sql_stmt</span><span class="p">][</span><span class="s2">&quot;job_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_result</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sql_stmt</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_result</span><span class="p">[</span>
                            <span class="s2">&quot;status&quot;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="kn">import</span> <span class="nn">pprint</span>
                        <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">job_result</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">e</span>
                    <span class="k">if</span> <span class="n">job_result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
                        <span class="n">run_as_usual</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">run_as_usual</span><span class="p">:</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_lib</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sql_stmt</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;running&quot;</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_project_lib_data</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">job_id</span>

    <span class="k">return</span> <span class="n">wrapped</span></div>


<div class="viewcode-block" id="SQLClient"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient">[docs]</a><span class="k">class</span> <span class="nc">SQLClient</span><span class="p">(</span><span class="n">COSClient</span><span class="p">,</span> <span class="n">SQLMagic</span><span class="p">,</span> <span class="n">HIVETable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The class the provides necessary APIs to interact with</span>

<span class="sd">    1. IBM SQL Serverless service</span>
<span class="sd">    2. IBM COS service</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cloud_apikey : str, optional</span>
<span class="sd">        an account-level API key [manage/Access (IAM)/IBM Cloud API keys]</span>
<span class="sd">    sqlquery_instance_crn :str, optional</span>
<span class="sd">        CRN from SQLQuery instance</span>
<span class="sd">    cos_out_url : str, optional</span>
<span class="sd">        the URI where retrieved data is stored</span>
<span class="sd">    max_concurrent_jobs: int, optional</span>
<span class="sd">        the max number of concurrent jobs</span>
<span class="sd">    client_info : str, optional</span>
<span class="sd">        User-defined string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">cloud_apikey</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                 <span class="n">sqlquery_instance_crn</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                 <span class="n">cos_out_url</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                 <span class="n">max_concurrent_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                 <span class="n">client_info</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">COSClient</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">cloud_apikey</span><span class="o">=</span><span class="n">cloud_apikey</span><span class="p">,</span>
                           <span class="n">cos_url</span><span class="o">=</span><span class="n">cos_out_url</span><span class="p">,</span>
                           <span class="n">client_info</span><span class="o">=</span><span class="n">client_info</span><span class="p">)</span>
        <span class="n">SQLMagic</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">HIVETable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">client_info</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span> <span class="o">=</span> <span class="s1">&#39;TimeSeries Cloud SQL Query Python&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span> <span class="o">=</span> <span class="n">client_info</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sqlquery_instance_crn</span> <span class="o">=</span> <span class="n">sqlquery_instance_crn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span> <span class="o">=</span> <span class="n">cos_out_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span> <span class="o">=</span> <span class="n">ibmcloudsql</span><span class="o">.</span><span class="n">SQLQuery</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apikey</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">sqlquery_instance_crn</span><span class="p">,</span>
                                              <span class="n">client_info</span><span class="o">=</span><span class="n">client_info</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrent_jobs</span> <span class="o">=</span> <span class="n">max_concurrent_jobs</span>  <span class="c1"># the current maximum concurrent jobs</span>

        <span class="c1"># The default URL where data should be queried</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cos_in_url_partitioned</span> <span class="o">=</span> <span class="s2">&quot;cos://us-geo/sql/customers_partitioned.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cos_in_url</span> <span class="o">=</span> <span class="s2">&quot;cos://us-geo/sql/customers.csv&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sql_stmt_create_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        CREATE TABLE </span><span class="si">{table_name}</span><span class="s2"></span>
<span class="s2">        USING CSV</span>
<span class="s2">        LOCATION </span><span class="si">{cos_in}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sql_stmt_show_temmplate</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SHOW TABLES</span>
<span class="s2">        INTO </span><span class="si">{cos_out}</span><span class="s2"> STORED AS CSV</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SQLClient created successful&quot;</span><span class="p">)</span>

        <span class="c1"># track the status of jobs - save the time to SQLQuery server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobs_tracking</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">my_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return information about jobs already queried via `get_job()`</span>
<span class="sd">        issued by this SQLClient class object</span>

<span class="sd">        This is different from :py:meth:`get_jobs()`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs_tracking</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ibmcloudsql.SQLQuery: retrieve the sqlClient engine object</span>

<span class="sd">        We use this to be able to use all functionality provided by ibmcloudsql package</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span>

<div class="viewcode-block" id="SQLClient.configure"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cloud_apikey</span><span class="p">,</span> <span class="n">sqlquery_instance_crn</span><span class="p">,</span> <span class="n">cos_out_url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; use this to update the configuration that is missing at __init__ method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span>
            <span class="s1">&#39;Enter IBM Cloud API Key (leave empty to use previous one): &#39;</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlquery_instance_crn</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
            <span class="s1">&#39;Enter SQL Query Instance CRN (leave empty to use previous one): &#39;</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlquery_instance_crn</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter target URI for SQL results: &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s1">&#39;Enter target URI for SQL results (leave empty to use &#39;</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span> <span class="o">+</span> <span class="s1">&#39;): &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span></div>

    <span class="c1"># Mirror ibmcloudsql.SQLQuery behavior</span>
    <span class="c1"># Some are extended</span>
<div class="viewcode-block" id="SQLClient.logon"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.logon">[docs]</a>    <span class="k">def</span> <span class="nf">logon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logon</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">logon</span><span class="p">()</span></div>

<div class="viewcode-block" id="SQLClient.run_templated_sql"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.run_templated_sql">[docs]</a>    <span class="k">def</span> <span class="nf">run_templated_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">sql_stmt</span><span class="p">,</span>
                          <span class="n">pagesize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">get_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">store_as</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run, and store the result as CSV, PARQUET</span>

<span class="sd">                Arguments:</span>
<span class="sd">                    sql_stmt {[type]} -- [description]</span>

<span class="sd">                Keyword Arguments:</span>
<span class="sd">                    pagesize {[type]} -- [description] (default: {None})</span>
<span class="sd">                    get_result {bool} -- [description] (default: {False})</span>
<span class="sd">                    blocking {bool} -- [description] (default: {True})</span>
<span class="sd">                    store_as {str} -- [description] (default: {&quot;csv&quot;})</span>

<span class="sd">        TODO: implement this</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="SQLClient.run"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">pagesize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">get_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; run the internal SQL statement provided by SQLMagic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_stmt</span><span class="p">,</span>
            <span class="n">pagesize</span><span class="o">=</span><span class="n">pagesize</span><span class="p">,</span>
            <span class="n">get_result</span><span class="o">=</span><span class="n">get_result</span><span class="p">,</span>
            <span class="n">blocking</span><span class="o">=</span><span class="n">blocking</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.run_sql"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.run_sql">[docs]</a>    <span class="k">def</span> <span class="nf">run_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">sql_stmt</span><span class="p">,</span>
                <span class="n">pagesize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">get_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend the behavior of ibmcloudsql.SQLClient.run_sql()</span>

<span class="sd">        1. returns a namedtuple</span>
<span class="sd">        2. ensure the job is successfully put into the queue</span>
<span class="sd">        3. synchronous call but has the option to NOT return the data - avoid memory overload</span>

<span class="sd">        Parameters</span>
<span class="sd">        --------------</span>
<span class="sd">        pagesize: int, optional</span>
<span class="sd">            an integer indicating the number of rows for each partition/page [using PARTITIONED EVERY &lt;pagesize&gt; ROWS syntax]</span>

<span class="sd">        get_result: bool, optional (default=False)</span>
<span class="sd">            add the capability to return only the job_id, but wait for the job&#39;s completion. Later, we can get the data using :meth:`.get_result` (job_id, pagenumber)</span>

<span class="sd">        blocking: bool, optional (default=True)</span>
<span class="sd">            If True, wait until the queue is available</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        namedtuple [`data`, `job_id`]</span>
<span class="sd">            `get_result` = True, then behavior like `ibmcloudsql.run_sql`() which load returned data into memory.</span>
<span class="sd">            The default behavior is opposite, to avoid unnecessarily overload the memory.</span>

<span class="sd">        Note</span>
<span class="sd">        -----</span>

<span class="sd">        The query can return data or not. If it is supposed to return data then</span>

<span class="sd">        * data can be of type: str (the error messsage, if failed) or pd.DataFrame (the real data, if succeed) - use `isinstance(data, str)` to check</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Container</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;RunSql&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;job_id&#39;</span><span class="p">])</span>

        <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_sql</span><span class="p">(</span>
            <span class="n">sql_stmt</span><span class="p">,</span>
            <span class="n">pagesize</span><span class="o">=</span><span class="n">pagesize</span><span class="p">,</span>
            <span class="n">blocking</span><span class="o">=</span><span class="n">blocking</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">job_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Job &quot;</span> <span class="o">+</span> <span class="n">job_id</span> <span class="o">+</span> <span class="s2">&quot; terminated with status: &quot;</span> <span class="o">+</span>
                     <span class="n">job_status</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job_status</span> <span class="o">==</span> <span class="s1">&#39;completed&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_result</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_status</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span><span class="p">:</span>
            <span class="n">job_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">job_status</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
            <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{status}</span><span class="s2">: SQL job </span><span class="si">{job_id}</span><span class="s2"> failed while executing with error </span><span class="si">{error}</span><span class="s2">. Detailed message: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">status</span><span class="o">=</span><span class="n">job_status</span><span class="p">,</span>
                    <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">,</span>
                    <span class="n">error</span><span class="o">=</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">],</span>
                    <span class="n">msg</span><span class="o">=</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;error_message&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="n">mycontainer</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mycontainer</span></div>

<div class="viewcode-block" id="SQLClient.submit_sql_with_checking_saved_jobs"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.submit_sql_with_checking_saved_jobs">[docs]</a>    <span class="nd">@check_saved_jobs_decorator</span>
    <span class="k">def</span> <span class="nf">submit_sql_with_checking_saved_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                            <span class="n">sql_stmt</span><span class="p">,</span>
                                            <span class="n">pagesize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the checking if a previous job is completed. The comparison is based on the SQL query content.</span>
<span class="sd">        The content of previous queries are stored in a file,</span>
<span class="sd">        with name given by `prefix` argument, stored as an asset in the Project-Lib.</span>
<span class="sd">        This is used in the scenario when you launch many many jobs, and don&#39;t want to restart from the</span>
<span class="sd">        beginning.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prefix : str, optional</span>
<span class="sd">            If it is used, it will looks into the ProjectLib for an asset file name $prefix.json</span>
<span class="sd">            and compare the full sql statement if it has been used</span>
<span class="sd">            If yes, and the result is successful, there is no need to rerun it</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">            This depends on the usage of :py:meth:`COSClient.connect_project_lib`,</span>
<span class="sd">            :py:meth:`COSClient.read_project_lib_data`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_sql</span><span class="p">(</span>
            <span class="n">sql_stmt</span><span class="p">,</span>
            <span class="n">pagesize</span><span class="o">=</span><span class="n">pagesize</span><span class="p">,</span>
            <span class="n">blocking</span><span class="o">=</span><span class="n">blocking</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.submit"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.submit">[docs]</a>    <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">pagesize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; run the internal SQL statement that you created using the APIs provided by SQLMagic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_stmt</span><span class="p">,</span>
            <span class="n">pagesize</span><span class="o">=</span><span class="n">pagesize</span><span class="p">,</span>
            <span class="n">blocking</span><span class="o">=</span><span class="n">blocking</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.submit_sql"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.submit_sql">[docs]</a>    <span class="k">def</span> <span class="nf">submit_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">sql_stmt</span><span class="p">,</span>
                   <span class="n">pagesize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronous call - submit and quickly return the job_id.</span>
<span class="sd">        It is recommended to use this API, instead of ibmcloudsql.SQLQuery.submit_sql()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sql_stmt: str</span>
<span class="sd">            SQL Query string</span>
<span class="sd">        pagesize: int, optional</span>
<span class="sd">            an integer indicating the number of rows for each partition/page</span>
<span class="sd">            [using PARTITIONED EVERY &lt;pagesize&gt; ROWS syntax]</span>
<span class="sd">        blocking : bool, optional (default=True)</span>
<span class="sd">            If True, wait until the queue is available</span>

<span class="sd">            Default, wait. Otherwise, return if the queue is not available</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            job_id</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        MaxRequestError</span>
<span class="sd">            when the SQLQUery instance is serving the max-limit of requests</span>

<span class="sd">        SyntaxError</span>
<span class="sd">            for both KeyError or HTTPError</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        .. code-block:: console</span>

<span class="sd">            curl -XPOST \</span>
<span class="sd">                --url &quot;https://api.sql-query.cloud.ibm.com/v2/sql_jobs?instance_crn=YOUR_SQL_QUERY_CRN&quot; \</span>
<span class="sd">                -H &quot;Accept: application/json&quot; \</span>
<span class="sd">                -H &quot;Authorization: Bearer YOUR_BEARER_TOKEN&quot; \</span>
<span class="sd">                -H &quot;Content-Type: application/json&quot; \</span>
<span class="sd">                -d &#39;{&quot;statement&quot;:&quot;SELECT firstname FROM cos://us-geo/sql/employees.parquet STORED AS PARQUET WHERE EMPLOYEEID=5 INTO cos://us-geo/target-bucket/q1-results&quot; }&#39;</span>

<span class="sd">        NOTE:</span>

<span class="sd">        1. All the headers (-H) can be put into a dictionary and</span>
<span class="sd">        passed to the *headers* argument of requests.post() API.</span>

<span class="sd">        2. All the data (-d option) is put into a dictionary and</span>
<span class="sd">        passed to the *json* argument of requests.post() API.</span>

<span class="sd">            * &#39;statement&#39;: value is full SQL statement in string</span>
<span class="sd">            * &#39;resultset_target&#39; (optional): only need when there is no &#39;INTO statement&#39; in the query string, and the value must be the COS URL output</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            sqlData = {&#39;statement&#39;: sql_stmt}</span>
<span class="sd">            request_headers = {&#39;Content-Type&#39;: &#39;application/json&#39;}</span>
<span class="sd">            request_headers.update({&#39;Accept&#39;:&#39;application/json&#39;})</span>
<span class="sd">            request_headers.update({&#39;User-Agent&#39;: self.user_agent})</span>
<span class="sd">            request_headers.update({&#39;authorization&#39;: &#39;Bearer {}&#39;.format(ro_credentials.token)})</span>
<span class="sd">            response = requests.post(</span>
<span class="sd">                &quot;https://api.sql-query.cloud.ibm.com/v2/sql_jobs?instance_crn={}&quot;.format(self.instance_crn),</span>
<span class="sd">                headers=request_headers,</span>
<span class="sd">                json=sqlData)</span>
<span class="sd">            \&quot;\&quot;\&quot;</span>
<span class="sd">            {</span>
<span class="sd">                &quot;errors&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                    &quot;code&quot;: &quot;bad_request&quot;,</span>
<span class="sd">                    &quot;message&quot;: &quot;Target url specified in parameter resultset_target and as part of into clause in statement&quot;</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                &quot;job_id&quot;: &quot;e2adca0a-9247-4cfa-ac58-db4b2bc33a01&quot;,</span>
<span class="sd">                &quot;status&quot;: &quot;queued&quot;</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                &quot;status_code&quot;: 429,</span>
<span class="sd">                &quot;errors&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                    &quot;code&quot;: &quot;too_many_requests&quot;,</span>
<span class="sd">                    &quot;message&quot;: &quot;This instance is currently running its maximum number of query jobs. Try again later, after at least one of the currently running jobs has completed.&quot;</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>
<span class="sd">            \&quot;\&quot;\&quot;</span>
<span class="sd">            # error code information: https://cloud.ibm.com/apidocs/sql-query</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">logon</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_headers</span><span class="p">[</span><span class="s2">&quot;authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">request_headers</span><span class="p">[</span>
            <span class="s2">&quot;authorization&quot;</span><span class="p">]</span>
        <span class="n">sql_text</span> <span class="o">=</span> <span class="n">sql_stmt</span>
        <span class="n">sqlData</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;statement&#39;</span><span class="p">:</span> <span class="n">sql_text</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">INTO_present</span><span class="p">(</span><span class="n">sql_text</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; check if INTO keyword is present in the SQL query&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="s2">&quot; INTO &quot;</span> <span class="ow">in</span> <span class="n">sql_text</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">INTO &quot;</span> <span class="ow">in</span> <span class="n">sql_text</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

        <span class="c1"># If a valid pagesize is specified we need to append the proper PARTITIONED EVERY &lt;num&gt; ROWS clause</span>
        <span class="k">if</span> <span class="n">pagesize</span> <span class="ow">or</span> <span class="n">pagesize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pagesize</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">pagesize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">INTO_present</span><span class="p">(</span><span class="n">sql_text</span><span class="p">):</span>
                    <span class="n">sqlData</span><span class="p">[</span><span class="s2">&quot;statement&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; INTO </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">INTO_present</span><span class="p">(</span><span class="n">sql_text</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                        <span class="s2">&quot;Neither resultset_target parameter nor </span><span class="se">\&quot;</span><span class="s2">INTO</span><span class="se">\&quot;</span><span class="s2"> clause specified.&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot; PARTITIONED &quot;</span> <span class="ow">in</span> <span class="n">sql_text</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                        <span class="s2">&quot;Must not use PARTITIONED clause when specifying pagesize parameter.&quot;</span>
                    <span class="p">)</span>
                <span class="n">sqlData</span><span class="p">[</span><span class="s2">&quot;statement&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; PARTITIONED EVERY </span><span class="si">{}</span><span class="s2"> ROWS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">pagesize</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;pagesize parameter (</span><span class="si">{}</span><span class="s1">) is not valid.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pagesize</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">INTO_present</span><span class="p">(</span><span class="n">sql_text</span><span class="p">):</span>
            <span class="n">sqlData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;resultset_target&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span><span class="p">})</span>

        <span class="k">def</span> <span class="nf">issue_request</span><span class="p">():</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">&quot;https://api.sql-query.cloud.ibm.com/v2/sql_jobs?instance_crn=</span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlquery_instance_crn</span><span class="p">),</span>
                <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_headers</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="n">sqlData</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>

        <span class="n">is_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="n">is_done</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">issue_request</span><span class="p">()</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">status_code</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">is_done</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="s2">&quot;status_code&quot;</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
                    <span class="n">status_code</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;status_code&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;status_code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">blocking</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="n">is_done</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_running_jobs</span><span class="p">()</span> <span class="o">&lt;</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrent_jobs</span><span class="p">):</span>
                                    <span class="k">break</span>
                                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># seconds</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">MaxRequestError</span><span class="p">(</span>
                                <span class="s2">&quot;SQL submission failed (</span><span class="si">{code}</span><span class="s2">): </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">code</span><span class="o">=</span><span class="n">status_code</span><span class="p">,</span>
                                    <span class="n">msg</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">blocking</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;job_id&#39;</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;job_id&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">HTTPError</span><span class="p">)</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                    <span class="s2">&quot;SQL submission failed (</span><span class="si">{code}</span><span class="s2">): </span><span class="si">{msg}</span><span class="s2"> - </span><span class="si">{query}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">code</span><span class="o">=</span><span class="n">status_code</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span>
                        <span class="n">query</span><span class="o">=</span><span class="n">pformat</span><span class="p">(</span><span class="n">sqlData</span><span class="p">)))</span>
        <span class="k">if</span> <span class="s2">&quot;job_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                <span class="s2">&quot;SQL submission failed (</span><span class="si">{code}</span><span class="s2">): </span><span class="si">{msg}</span><span class="s2"> - </span><span class="si">{query}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">code</span><span class="o">=</span><span class="n">status_code</span><span class="p">,</span>
                    <span class="n">msg</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;errors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span>
                    <span class="n">query</span><span class="o">=</span><span class="n">pformat</span><span class="p">(</span><span class="n">sqlData</span><span class="p">)))</span></div>

<div class="viewcode-block" id="SQLClient.wait_for_job"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.wait_for_job">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It&#39;s possible that the job&#39;s failed because of Spark&#39;s internal error.</span>
<span class="sd">        So &quot;unknown&quot; is added for such cases.</span>

<span class="sd">        Return</span>
<span class="sd">        -------</span>
<span class="sd">            &#39;failed&#39;, &#39;completed&#39;, or &#39;unknown&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">wait_for_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnboundLocalError</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="SQLClient.process_failed_jobs_until_all_completed"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.process_failed_jobs_until_all_completed">[docs]</a>    <span class="k">def</span> <span class="nf">process_failed_jobs_until_all_completed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        re-send those that are failed - due to the time-out mechanism of SQL Query server</span>

<span class="sd">        Here, if job_time &lt; 40 minutes, then we re-send.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">complete_all</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="n">complete_all</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">complete_all</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">job_id_list</span><span class="p">):</span>
                <span class="n">job_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">job_result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                        <span class="n">job_result</span><span class="p">[</span><span class="s2">&quot;end_time&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                            <span class="n">job_result</span><span class="p">[</span><span class="s2">&quot;submit_time&quot;</span><span class="p">])</span>
                    <span class="n">job_time</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">job_time</span> <span class="o">&lt;</span> <span class="mi">2400</span><span class="p">:</span>  <span class="c1"># 40 minutes</span>
                        <span class="n">new_job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_sql</span><span class="p">(</span><span class="n">job_result</span><span class="p">[</span><span class="s2">&quot;statement&quot;</span><span class="p">])</span>
                        <span class="n">job_id_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_job_id</span>
                        <span class="n">complete_all</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">job_id_list</span></div>

<div class="viewcode-block" id="SQLClient.get_result"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_result">[docs]</a>    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">pagenumber</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        job_id: int</span>
<span class="sd">            The value, if not stored, can be retrieved from self.get_jobs()</span>
<span class="sd">        pagenumber: int, optional</span>
<span class="sd">            If the data, from the given `job_id` is saved in pages/partitions, then this should be a value</span>
<span class="sd">            in the range from 1 to len(self.list_results(job_id))</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dataframe</span>
<span class="sd">            The dataframe holding the queried data from a completed job</span>


<span class="sd">        .. code-block:: console</span>

<span class="sd">            curl -XGET \</span>
<span class="sd">                --url &quot;https://api.sql-query.cloud.ibm.com/v2/sql_jobs?instance_crn=&lt;YOUR_SQL_QUERY_CRN&gt;&quot; \</span>
<span class="sd">                -H &quot;Accept: application/json&quot; \</span>
<span class="sd">                -H &quot;Authorization: Bearer &lt;YOUR_BEARER_TOKEN&gt;&quot;  \</span>
<span class="sd">                -H &quot;Content-Type: application/json&quot;</span>

<span class="sd">            \&quot;\&quot;\&quot;</span>
<span class="sd">            {</span>
<span class="sd">            &quot;jobs&quot;: [</span>
<span class="sd">                {</span>
<span class="sd">                &quot;job_id&quot;: &quot;7ebed7f7-00dc-44a2-acfa-5bdb53889648&quot;,</span>
<span class="sd">                &quot;status&quot;: &quot;completed&quot;,</span>
<span class="sd">                &quot;submit_time&quot;: &quot;2018-08-14T08:45:54.012Z&quot;,</span>
<span class="sd">                &quot;user_id&quot;: &quot;user1@ibm.com&quot;</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                &quot;job_id&quot;: &quot;ffde4c5a-1cc2-448b-b377-43573818e5d8&quot;,</span>
<span class="sd">                &quot;status&quot;: &quot;completed&quot;,</span>
<span class="sd">                &quot;submit_time&quot;: &quot;2018-08-14T08:47:33.350Z&quot;,</span>
<span class="sd">                &quot;user_id&quot;: &quot;user1@ibm.com&quot;</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>
<span class="sd">            }</span>
<span class="sd">            \&quot;\&quot;\&quot;</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            response = requests.get(</span>
<span class="sd">                &quot;https://api.sql-query.cloud.ibm.com/v2/sql_jobs/{}?instance_crn={}&quot;.format(jobId, self.instance_crn),</span>
<span class="sd">                headers=self.request_headers,</span>
<span class="sd">            )</span>

<span class="sd">            if response.status_code == 200 or response.status_code == 201:</span>
<span class="sd">                status_response = response.json()</span>

<span class="sd">            https://cloud.ibm.com/apidocs/sql-query#run-an-sql-job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">pagenumber</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.delete_result"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.delete_result">[docs]</a>    <span class="k">def</span> <span class="nf">delete_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        ------</span>
<span class="sd">        dataframe</span>
<span class="sd">            A dataframe, with 3 rows, and one field name &quot;Deleted Object&quot;</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Delete 3 entries in the output COS</span>

<span class="sd">        .. code-block:: console</span>

<span class="sd">            cos://&lt;cos-name&gt;/bucket_name/jobid=&lt;JOB-ID-NUMBER&gt;/</span>
<span class="sd">            cos://&lt;cos-name&gt;/bucket_name/jobid=&lt;JOB-ID-NUMBER&gt;/_SUCCESS</span>
<span class="sd">            cos://&lt;cos-name&gt;/bucket_name/jobid=&lt;JOB-ID-NUMBER&gt;/[parquet|csv|json]</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>

<span class="sd">        * The last entry holds the real data, and the last word also indicates the data format</span>
<span class="sd">        * &#39;JOBPREFIX NONE&#39;  would avoid having &#39;jobid=JOB-ID-NAME&#39; in the URL</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">delete_result</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.get_job_demo"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_job_demo">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_demo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return an example when you issue get_job(job_idj)&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;bytes_read&quot;</span><span class="p">:</span> <span class="mi">43058</span><span class="p">,</span>
            <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-03-08T03:20:39.131Z&quot;</span><span class="p">,</span>
            <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ab3f7567-280b-40c9-87a9-256b846f89db&quot;</span><span class="p">,</span>
            <span class="s2">&quot;plan_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ead0f7f5-0c96-40c0-9aae-63c4846d8188&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resultset_format&quot;</span><span class="p">:</span> <span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resultset_location&quot;</span><span class="p">:</span>
            <span class="s2">&quot;cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rows_read&quot;</span><span class="p">:</span> <span class="mi">921</span><span class="p">,</span>
            <span class="s2">&quot;rows_returned&quot;</span><span class="p">:</span> <span class="mi">830</span><span class="p">,</span>
            <span class="s2">&quot;statement&quot;</span><span class="p">:</span>
            <span class="s2">&quot;SELECT OrderID, c.CustomerID CustomerID, CompanyName, ContactName, ContactTitle, Address, City, Region, PostalCode, Country, Phone, Fax          EmployeeID, OrderDate, RequiredDate, ShippedDate, ShipVia, Freight, ShipName, ShipAddress,          ShipCity, ShipRegion, ShipPostalCode, ShipCountry FROM cos://us-geo/sql/orders.parquet STORED AS PARQUET o,          cos://us-geo/sql/customers.parquet STORED AS PARQUET c          WHERE c.CustomerID = o.CustomerID          INTO cos://us-south/tuan-sql-result/customer_orders STORED AS PARQUET PARTITIONED BY (ShipCountry, ShipCity)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
            <span class="s2">&quot;submit_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-03-08T03:20:00.617Z&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="s2">&quot;tmhoangt@us.ibm.com&quot;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="SQLClient.get_job"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_job">[docs]</a>    <span class="k">def</span> <span class="nf">get_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            a dict of job details (see keys below)</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            &#39;job_id&#39;,</span>
<span class="sd">            &#39;status&#39;, : &quot;running&quot;, &quot;failed&quot;, &quot;completed&quot;</span>
<span class="sd">            &#39;statement&#39;: &quot;SELECT * ...&quot; [the content of SQL Query],</span>
<span class="sd">            &#39;plan_id&#39; ,</span>
<span class="sd">            &#39;submit_time&#39;,</span>
<span class="sd">            &#39;resultset_location&#39;,</span>
<span class="sd">            &#39;rows_returned&#39;,</span>
<span class="sd">            &#39;rows_read&#39; ,</span>
<span class="sd">            &#39;bytes_read&#39; ,</span>
<span class="sd">            &#39;resultset_format&#39;: &#39;csv&#39;,</span>
<span class="sd">            &#39;end_time&#39;: &#39;2020-03-06T21:58:26.274Z&#39;,</span>
<span class="sd">            &#39;user_id&#39;: &#39;username@us.ibm.com&#39;</span>

<span class="sd">        Example</span>
<span class="sd">        --------</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            {</span>
<span class="sd">                &quot;bytes_read&quot;: 43058,</span>
<span class="sd">                &quot;end_time&quot;: &quot;2020-03-08T03:20:39.131Z&quot;,</span>
<span class="sd">                &quot;job_id&quot;: &quot;ab3f7567-280b-40c9-87a9-256b846f89db&quot;,</span>
<span class="sd">                &quot;plan_id&quot;: &quot;ead0f7f5-0c96-40c0-9aae-63c4846d8188&quot;,</span>
<span class="sd">                &quot;resultset_format&quot;: &quot;parquet&quot;,</span>
<span class="sd">                &quot;resultset_location&quot;: &quot;cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db&quot;,</span>
<span class="sd">                &quot;rows_read&quot;: 921,</span>
<span class="sd">                &quot;rows_returned&quot;: 830,</span>
<span class="sd">                &quot;statement&quot;: &quot;SELECT OrderID, c.CustomerID CustomerID, CompanyName, ContactName, ContactTitle, Address, City, Region, PostalCode, Country, Phone, Fax          EmployeeID, OrderDate, RequiredDate, ShippedDate, ShipVia, Freight, ShipName, ShipAddress,          ShipCity, ShipRegion, ShipPostalCode, ShipCountry FROM cos://us-geo/sql/orders.parquet STORED AS PARQUET o,          cos://us-geo/sql/customers.parquet STORED AS PARQUET c          WHERE c.CustomerID = o.CustomerID          INTO cos://us-south/tuan-sql-result/customer_orders STORED AS PARQUET PARTITIONED BY (ShipCountry, ShipCity)&quot;,</span>
<span class="sd">                &quot;status&quot;: &quot;completed&quot;,</span>
<span class="sd">                &quot;submit_time&quot;: &quot;2020-03-08T03:20:00.617Z&quot;,</span>
<span class="sd">                &quot;user_id&quot;: &quot;tmhoangt@us.ibm.com&quot;</span>
<span class="sd">            }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs_tracking</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">jobs_tracking</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;running&quot;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs_tracking</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error at querying job </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobs_tracking</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="SQLClient.get_jobs"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">get_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the up-to-30 most recent jobs from the given Cloud API</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dataframe</span>
<span class="sd">            a pd.DataFrame with fields - total 30 rows, corresponding to the 30 most recent jobs</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        .. code-block:: console</span>

<span class="sd">            job_id</span>
<span class="sd">            status: &quot;running&quot;, &quot;failed&quot;, &quot;completed&quot;</span>
<span class="sd">            user_id</span>
<span class="sd">            statement</span>
<span class="sd">            resultset_location</span>
<span class="sd">            submit_time</span>
<span class="sd">            end_time</span>
<span class="sd">            rows_read</span>
<span class="sd">            rows_returned</span>
<span class="sd">            bytes_read</span>
<span class="sd">            error</span>
<span class="sd">            error_message</span>

<span class="sd">        .. code-block:: console</span>

<span class="sd">            job_id	status	user_id	statement	resultset_location	submit_time	end_time	rows_read	rows_returned	bytes_read	error	error_message</span>
<span class="sd">            8d9c5a97-808f-4a08-9cc3-78e3f07f7ba8	completed	tmhoangt@us.ibm.com	SELECT o.OrderID, c.CompanyName, e.FirstName, e.LastName FROM cos://us-geo/sql/orders.parquet STORED AS PARQUET o, cos://us-geo/sql/employees.parquet STORED AS PARQUET e, cos://us-geo/sql/customers.parquet STORED AS PARQUET c WHERE e.EmployeeID = o.EmployeeID AND c.CustomerID = o.CustomerID AND o.ShippedDate &gt; o.RequiredDate AND o.OrderDate &gt; &quot;1998-01-01&quot; ORDER BY c.CompanyName	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/jobid=8d9c5a97-808f-4a08-9cc3-78e3f07f7ba8	2020-02-21T16:19:03.638Z	2020-02-21T16:19:13.691Z	1760	29	41499	None	None</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>

<span class="sd">        * get_jobs() is used by export_job_history(cos_out_url) which is used to save such data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">get_jobs</span><span class="p">()</span></div>

<div class="viewcode-block" id="SQLClient.get_jobs_count_with_status"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_jobs_count_with_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_jobs_count_with_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the number of jobs in the SQL Query server for the given `status`&quot;&quot;&quot;</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jobs</span><span class="p">()</span>
        <span class="n">num_jobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">status</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">num_jobs</span></div>

<div class="viewcode-block" id="SQLClient.get_number_running_jobs"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_number_running_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_running_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the number of running jobs in the SQL Query server&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jobs_count_with_status</span><span class="p">(</span><span class="s1">&#39;running&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.get_jobs_matching"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_jobs_matching">[docs]</a>    <span class="k">def</span> <span class="nf">get_jobs_matching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id_list</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;completed&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the list of job_id that have the given status</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        job_id_list: list</span>
<span class="sd">            List of job_id</span>
<span class="sd">        status : str, optional</span>
<span class="sd">            &quot;completed&quot;, or &quot;failed&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="n">job_id_list</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">status</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="SQLClient.export_job_history"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.export_job_history">[docs]</a>    <span class="k">def</span> <span class="nf">export_job_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cos_out_url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the most recent jobs to COS URL</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cos_out_url : str</span>
<span class="sd">            A COS URL with prefix, i.e. cos://&lt;cos-name&gt;/&lt;bucket&gt;/&lt;prefix&gt;,</span>
<span class="sd">            where the data will be stored</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">export_job_history</span><span class="p">(</span><span class="n">cos_out_url</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.help"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Help method&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sql_info</span><span class="p">()</span></div>

<div class="viewcode-block" id="SQLClient.sql_info"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.sql_info">[docs]</a>    <span class="k">def</span> <span class="nf">sql_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Use this to get useful information about SQL Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">        SQL Query statement:</span>

<span class="s2">            SELECT OrderID, c.CustomerID CustomerID, CompanyName, ContactName, ContactTitle, Address, City, Region, PostalCode, Country, Phone, Fax          EmployeeID, OrderDate, RequiredDate, ShippedDate, ShipVia, Freight, ShipName, ShipAddress,          ShipCity, ShipRegion, ShipPostalCode, ShipCountry</span>
<span class="s2">            FROM cos://us-geo/sql/orders.parquet STORED AS PARQUET o, cos://us-geo/sql/customers.parquet STORED AS PARQUET c          WHERE c.CustomerID = o.CustomerID</span>
<span class="s2">            INTO cos://us-south/tuan-sql-result/customer_orders [JOBPREFIX NONE] STORED AS PARQUET PARTITIONED BY (ShipCountry, ShipCity)</span>


<span class="s2">        The path specified in the URI of the INTO clause above is used as a logical root &quot;folder&quot;,</span>
<span class="s2">        which is nothing else than an empty object.</span>
<span class="s2">        For the real location where the queried data is stored:</span>
<span class="s2">            * It will normally include a suffix containing the</span>
<span class="s2">            unique jobId that produced this result.</span>
<span class="s2">            * But because the queryabove used the optional clause JOBPREFIX NONE this suffix is ommitted,</span>
<span class="s2">            which means each time the same targer path will be used with that clause the previous list of objects</span>
<span class="s2">            in that logical folder will be overwritten.</span>

<span class="s2">        If the result of the SQL job was written in a partitioned way, you can now optionally restructure the objects</span>
<span class="s2">        to a single object with the exact name that was specified in the INTO clause of the SQL job.</span>

<span class="s2">        .. code-block:: python</span>

<span class="s2">            sqlClient.rename_exact_result(jobId)</span>
<span class="s2">            sqlClient.list_results(jobId).head(100)</span>

<span class="s2">        Example: if JOBPREFIX NONE is used</span>

<span class="s2">            ObjectURL	Size	Bucket	Object</span>
<span class="s2">        0	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/first100orders.parquet/	10271	tuan-sql-result	first100orders.parquet</span>

<span class="s2">        Example: if JOBPREFIX NONE is NOT used</span>
<span class="s2">            ObjectURL	Size	Bucket	Object</span>
<span class="s2">        0	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/first100orders.parquet/jobid=7d15668e-c691-476a-9792-3c7ef723952c	10271	tuan-sql-result	first100orders.parquet/jobid=7d15668e-c691-476a-9792-3c7ef723952c</span>

<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="SQLClient.rename_exact_result_joblist"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.rename_exact_result_joblist">[docs]</a>    <span class="k">def</span> <span class="nf">rename_exact_result_joblist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="n">job_list</span><span class="p">,</span>
                                    <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The bulk mode of `rename_exact_result` method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        job_list: list</span>
<span class="sd">            A list of job_id</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="n">job_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename_exact_result</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="n">blocking</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.rename_exact_result"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.rename_exact_result">[docs]</a>    <span class="k">def</span> <span class="nf">rename_exact_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A SQL Query can store data into partitioned/paginated multiple objects, or single object.</span>

<span class="sd">        Even with single object, indeed, multiple objects are created, two of them has size 0.</span>
<span class="sd">        (&lt;URL&gt;/_SUCCESS, and &lt;URL&gt;/) beside the one that holds data (&lt;URL&gt;/)</span>

<span class="sd">        This API delete the two 0-size objects, and keep only the one that holds data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        job_id : str</span>
<span class="sd">            A string representation of job_id</span>

<span class="sd">        blocking: bool, optional</span>
<span class="sd">            Default is wait</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the job_id is the job in that the result is &quot;PARTITIONED BY&quot; or &quot;pagesize=&quot; or &quot;PARITIONED EVERY x ROWS&quot; is used</span>
<span class="sd">            or the rename_exact_result() has been applied to this job_id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># return self.sqlClient.rename_exact_result(job_id)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logon</span><span class="p">()</span>
        <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="n">job_status</span> <span class="o">=</span> <span class="n">job_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">job_status</span> <span class="o">==</span> <span class="s2">&quot;running&quot;</span> <span class="ow">and</span> <span class="n">blocking</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">job_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="n">job_status</span> <span class="o">=</span> <span class="n">job_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">job_status</span> <span class="o">==</span> <span class="s1">&#39;running&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;SQL job with jobId </span><span class="si">{}</span><span class="s1"> still running. Come back later.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobId</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">job_status</span> <span class="o">!=</span> <span class="s1">&#39;completed&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;SQL job with jobId </span><span class="si">{}</span><span class="s1"> did not finish successfully. No result available.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jobId</span><span class="p">))</span>

        <span class="k">if</span> <span class="s2">&quot;resultset_location&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_details</span> <span class="ow">or</span> <span class="n">job_details</span><span class="p">[</span>
                <span class="s2">&quot;resultset_location&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">url_parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">job_details</span><span class="p">[</span><span class="s1">&#39;resultset_location&#39;</span><span class="p">])</span>
        <span class="n">cos_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_cos_client</span><span class="p">(</span><span class="n">url_parsed</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span>

        <span class="n">result_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_results</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Renaming partitioned results of job_id </span><span class="si">{}</span><span class="s1"> to single exact result object name not supported.&#39;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span>
                                         <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Results of job_id </span><span class="si">{}</span><span class="s1"> don</span><span class="se">\&#39;</span><span class="s1">t seem to be regular SQL query output.&#39;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># HANDLING  [can be 2 rows or 3 rows] - only the last row can be non-zero in size</span>
        <span class="n">max_row_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_objects</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">pre_row_zeros</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_row_index</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Size</span><span class="p">[</span><span class="n">row</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pre_row_zeros</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">pre_row_zeros</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Results of job_id </span><span class="si">{}</span><span class="s1"> don</span><span class="se">\&#39;</span><span class="s1">t seem to be regular SQL query output.&#39;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">))</span>
        <span class="n">copy_source</span> <span class="o">=</span> <span class="n">result_objects</span><span class="o">.</span><span class="n">Bucket</span><span class="p">[</span>
            <span class="n">max_row_index</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">result_objects</span><span class="o">.</span><span class="n">Object</span><span class="p">[</span><span class="n">max_row_index</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># basically copy the object[2] to object[0]</span>
            <span class="c1"># then delete object[2] and object[1]</span>
            <span class="n">cos_client</span><span class="o">.</span><span class="n">copy_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Bucket</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">CopySource</span><span class="o">=</span><span class="n">copy_source</span><span class="p">,</span>
                                   <span class="n">Key</span><span class="o">=</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Object</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">cos_client</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Bucket</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                     <span class="n">Key</span><span class="o">=</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Object</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">cos_client</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Bucket</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">Key</span><span class="o">=</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Object</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># len(result_objects) == 2</span>
            <span class="n">cos_client</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Bucket</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">Key</span><span class="o">=</span><span class="n">result_objects</span><span class="o">.</span><span class="n">Object</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="SQLClient.get_cos_summary_demo"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_cos_summary_demo">[docs]</a>    <span class="k">def</span> <span class="nf">get_cos_summary_demo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return a demo example of the result of .get_cos_summary(cos_resultset_location)</span>
<span class="sd">        with</span>

<span class="sd">        * cos_resultset_location is the cos://&lt;cos-name&gt;/&lt;bucket&gt;/[jobid=JOB-ID-NAME]/</span>

<span class="sd">        NOTE: &#39;JOBPREFIX NONE&#39;  would avoid having &#39;jobid=JOB-ID-NAME&#39; in the URL</span>

<span class="sd">        total_volume:  &lt;float-number&gt; [KB | MB | GB | TB]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;largest_object&quot;</span><span class="p">:</span>
            <span class="s2">&quot;customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db/ShipCountry=UK/ShipCity=London/part-00015-f741bb3e-bbff-4e1f-88ec-1425d546a9d6-attempt_20200308032024_0006_m_000015_0.c000.snappy.parquet&quot;</span><span class="p">,</span>
            <span class="s2">&quot;largest_object_size&quot;</span><span class="p">:</span>
            <span class="s2">&quot;7.1 KB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;newest_object_timestamp&quot;</span><span class="p">:</span>
            <span class="s2">&quot;March 08, 2020, 03H:20M:34S&quot;</span><span class="p">,</span>
            <span class="s2">&quot;oldest_object_timestamp&quot;</span><span class="p">:</span>
            <span class="s2">&quot;March 08, 2020, 03H:20M:19S&quot;</span><span class="p">,</span>
            <span class="s2">&quot;smallest_object&quot;</span><span class="p">:</span>
            <span class="s2">&quot;customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db&quot;</span><span class="p">,</span>
            <span class="s2">&quot;smallest_object_size&quot;</span><span class="p">:</span>
            <span class="s2">&quot;0.0 B&quot;</span><span class="p">,</span>
            <span class="s2">&quot;total_objects&quot;</span><span class="p">:</span>
            <span class="mi">72</span><span class="p">,</span>
            <span class="s2">&quot;total_volume&quot;</span><span class="p">:</span>
            <span class="s2">&quot;401.7 KB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span>
            <span class="s2">&quot;cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db&quot;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="SQLClient.get_cos_summary"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_cos_summary">[docs]</a>    <span class="k">def</span> <span class="nf">get_cos_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cos_resultset_location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return information for the given COR URL (may include bucket + prefix)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dict with keys</span>
<span class="sd">                &quot;largest_object&quot;</span>
<span class="sd">                &quot;largest_object_size&quot;</span>
<span class="sd">                &quot;newest_object_timestamp&quot;</span>
<span class="sd">                &quot;oldest_object_timestamp&quot;</span>
<span class="sd">                &quot;smallest_object&quot;</span>
<span class="sd">                &quot;smallest_object_size&quot;</span>
<span class="sd">                &quot;total_objects&quot;</span>
<span class="sd">                &quot;total_volume&quot;</span>
<span class="sd">                &quot;url&quot;</span>

<span class="sd">        Example: self.get_cos_summary_demo()</span>

<span class="sd">        Call ibmcloudsql.SQLCLient.get_cos_summary()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">get_cos_summary</span><span class="p">(</span><span class="n">cos_resultset_location</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.list_results_demo"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.list_results_demo">[docs]</a>    <span class="k">def</span> <span class="nf">list_results_demo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        The demo of list_results()</span>

<span class="s2">        SQL:</span>
<span class="s2">            SELECT OrderID, c.CustomerID CustomerID, CompanyName, ContactName, ContactTitle, Address, City, Region, PostalCode, Country, Phone, Fax          EmployeeID, OrderDate, RequiredDate, ShippedDate, ShipVia, Freight, ShipName, ShipAddress,          ShipCity, ShipRegion, ShipPostalCode, ShipCountry</span>
<span class="s2">            FROM cos://us-geo/sql/orders.parquet STORED AS PARQUET o,          cos://us-geo/sql/customers.parquet STORED AS PARQUET c          WHERE c.CustomerID = o.CustomerID</span>
<span class="s2">            INTO cos://us-south/tuan-sql-result/customer_orders STORED AS PARQUET PARTITIONED BY (ShipCountry, ShipCity)</span>

<span class="s2">        Example</span>
<span class="s2">        -------</span>
<span class="s2">        Single object result</span>

<span class="s2">        --&gt; DataFrame as</span>

<span class="s2">                    ObjectURL	Size	Bucket	Object</span>
<span class="s2">        0	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/first100orders.parquet	0	tuan-sql-result	first100orders.parquet</span>
<span class="s2">        1	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/first100orders.parquet/_SUCCESS	0	tuan-sql-result	first100orders.parquet/_SUCCESS</span>
<span class="s2">        2	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/first100orders.parquet/part-00000-a6ca5e41-2eba-4874-86f8-9853d5e48f09-c000-attempt_20200308041706_0005_m_000000_0.snappy.parquet	10271	tuan-sql-result	first100orders.parquet/part-00000-a6ca5e41-2eba-4874-86f8-9853d5e48f09-c000-attempt_20200308041706_0005_m_000000_0.snappy.parquet</span>

<span class="s2">        Example</span>
<span class="s2">        -------</span>
<span class="s2">        Partitioned/Paginated result</span>

<span class="s2">        --&gt;</span>
<span class="s2">        DataFrame as</span>

<span class="s2">                ObjectURL	Size	Bucket	Object</span>
<span class="s2">        0	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db	0	tuan-sql-result	customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db</span>
<span class="s2">        1	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db/_SUCCESS	0	tuan-sql-result	customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db/_SUCCESS</span>
<span class="s2">        2	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db/ShipCountry=Argentina/ShipCity=Buenos Aires/part-00065-f741bb3e-bbff-4e1f-88ec-1425d546a9d6-attempt_20200308032026_0006_m_000065_0.c000.snappy.parquet	6412	tuan-sql-result	customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db/ShipCountry=Argentina/ShipCity=Buenos Aires/part-00065-f741bb3e-bbff-4e1f-88ec-1425d546a9d6-attempt_20200308032026_0006_m_000065_0.c000.snappy.parquet</span>
<span class="s2">        3	cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db/ShipCountry=Austria/ShipCity=Graz/part-00096-f741bb3e-bbff-4e1f-88ec-1425d546a9d6-attempt_20200308032026_0006_m_000096_0.c000.snappy.parquet	6094	tuan-sql-result	customer_orders/jobid=ab3f7567-280b-40c9-87a9-256b846f89db/ShipCountry=Austria/ShipCity=Graz/part-00096-f741bb3e-bbff-4e1f-88ec-1425d546a9d6-attempt_20200308032026_0006_m_000096_0.c000.snappy.parquet</span>

<span class="s2">        NOTE: In hive style partitioning the partition column values are not stored in the objects but rather in the object names.</span>

<span class="s2">        The DataFrame for each partition would have the fields, in this example</span>

<span class="s2">            Index([&#39;OrderID&#39;, &#39;CustomerID&#39;, &#39;CompanyName&#39;, &#39;ContactName&#39;, &#39;ContactTitle&#39;,</span>
<span class="s2">        &#39;Address&#39;, &#39;City&#39;, &#39;Region&#39;, &#39;PostalCode&#39;, &#39;Country&#39;, &#39;Phone&#39;,</span>
<span class="s2">        &#39;EmployeeID&#39;, &#39;OrderDate&#39;, &#39;RequiredDate&#39;, &#39;ShippedDate&#39;, &#39;ShipVia&#39;,</span>
<span class="s2">        &#39;Freight&#39;, &#39;ShipName&#39;, &#39;ShipAddress&#39;, &#39;ShipRegion&#39;, &#39;ShipPostalCode&#39;,</span>
<span class="s2">        &#39;ShipCountry&#39;, &#39;ShipCity&#39;],</span>
<span class="s2">        dtype=&#39;object&#39;)</span>

<span class="s2">        The queried data, when stored as **partioned data** then can be queried very efficient</span>

<span class="s2">            * IN_COS_URL = cos://s3.us-south.cloud-object-storage.appdomain.cloud/sqltempregional/customer_orders/jobid=16cb6bcc-56e6-4c84-9dd2-6d9ee344e954</span>

<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="SQLClient.list_results"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.list_results">[docs]</a>    <span class="k">def</span> <span class="nf">list_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NOTE: A single SQL Query can store the queried data in the COS output</span>
<span class="sd">        in multiple objects/partitions</span>

<span class="sd">        When one of those below is used</span>

<span class="sd">        .. code-block:: console</span>

<span class="sd">            [ PARTITIONED BY,</span>
<span class="sd">            PARTITIONED EVERY x ROWS      [implicitly used with pagesize=X option]</span>
<span class="sd">            ]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        job_id: str</span>
<span class="sd">            The Job ID</span>
<span class="sd">        blocking: bool, default: True</span>
<span class="sd">            If True, wait for the available slot in the work queue</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            None (or nothing) if the function fails</span>

<span class="sd">            DataFrame (4 fields: ObjectURL, Size, Bucket, Object) - each row correspond to the information of one partition</span>

<span class="sd">        Raises</span>
<span class="sd">        ----------</span>
<span class="sd">            ValueError</span>

<span class="sd">        Notes</span>
<span class="sd">        -------</span>
<span class="sd">            To know the number of partitions being used, use &#39;len(self.list_results(job_id))&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># return self.sqlClient.list_results(job_id)</span>
        <span class="k">if</span> <span class="n">blocking</span><span class="p">:</span>
            <span class="n">job_running</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">while</span> <span class="n">job_running</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">list_results</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
                    <span class="n">job_running</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;running&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">e</span>
        <span class="k">return</span> <span class="n">x</span></div>

    <span class="c1"># Extended functionality</span>
<div class="viewcode-block" id="SQLClient.show_catalog_tables"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.show_catalog_tables">[docs]</a>    <span class="k">def</span> <span class="nf">show_catalog_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sql_stmt_show</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sql_stmt_show_temmplate</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">cos_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># df = self.sqlClient.run_sql(sql_stmt_show)</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_sql</span><span class="p">(</span><span class="n">sql_stmt_show</span><span class="p">)</span>
            <span class="n">sql_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">wait_for_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sql_status</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">sql_stmt_show</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sql_status</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fail at SHOW TABLE&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="SQLClient.drop_all_catalog_tables"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.drop_all_catalog_tables">[docs]</a>    <span class="k">def</span> <span class="nf">drop_all_catalog_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete all created catalog tables in the project</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True [if success]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_catalog_tables</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;tableName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drop_catalog_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">partitioned_tables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">regular_tables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partitioned_tables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regular_tables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="SQLClient.drop_catalog_tables"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.drop_catalog_tables">[docs]</a>    <span class="k">def</span> <span class="nf">drop_catalog_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop a list of catalog tables</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            table_names: list</span>
<span class="sd">                A list of catalog tables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drop_catalog_table</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.drop_catalog_table"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.drop_catalog_table">[docs]</a>    <span class="k">def</span> <span class="nf">drop_catalog_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop a given catalog table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table_name: str, optional</span>
<span class="sd">            The name of the catalog table</span>
<span class="sd">            If skipped, the being tracked catalog-table is used</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_catalog_table_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: please provide table_name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_catalog_table_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_catalog_table_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">sql_stmt_drop</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DROP TABLE </span><span class="si">{table_name}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt_drop</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Job_id (</span><span class="si">{stmt}</span><span class="s2">): </span><span class="si">{job_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stmt</span><span class="o">=</span><span class="n">sql_stmt_drop</span><span class="p">,</span>
                                                            <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># There is a bug - the DROP TABLE statement does not need a returned COS URI - but it seems the Python API looks for that</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partitioned_tables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regular_tables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="SQLClient.get_catalog_table"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_catalog_table">[docs]</a>    <span class="k">def</span> <span class="nf">get_catalog_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">table_name</span><span class="p">,</span>
                          <span class="n">cos_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">force_recreate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;synchronous version</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table_name: str</span>
<span class="sd">            The name of the catalog table</span>

<span class="sd">        cos_url : str, optional</span>
<span class="sd">            The COS URL from which the catalog table should reference to</span>
<span class="sd">            If not provided, it uses the internal `self.cos_in_url`</span>

<span class="sd">        force_recreate: bool, optional</span>
<span class="sd">            (True) force to recreate an existing catalog table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            none if job &quot;failed&quot;</span>
<span class="sd">            otherwise returns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_catalog_table_async</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span>
                                              <span class="n">cos_url</span><span class="p">,</span>
                                              <span class="n">force_recreate</span><span class="o">=</span><span class="n">force_recreate</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">job_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">job_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">wait_for_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">job_status</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SQLClient.get_catalog_table_async"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_catalog_table_async">[docs]</a>    <span class="k">def</span> <span class="nf">get_catalog_table_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                <span class="n">table_name</span><span class="p">,</span>
                                <span class="n">cos_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">force_recreate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the async version of `get_catalog_table`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table_name: str</span>
<span class="sd">            The name of the catalog table</span>

<span class="sd">        cos_url : str, optional</span>
<span class="sd">            The COS URL from which the catalog table should reference to</span>
<span class="sd">            If not provided, it uses the internal `self.cos_in_url`</span>

<span class="sd">        force_recreate: bool, optional</span>
<span class="sd">            (True) force to recreate an existing catalog table</span>

<span class="sd">        Returns</span>
<span class="sd">        ------</span>
<span class="sd">            job_id [if the table is being created]</span>
<span class="sd">            None   [if the table already created]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_catalog_table_name</span> <span class="o">=</span> <span class="n">table_name</span>

        <span class="k">if</span> <span class="n">cos_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cos_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos_in_url</span>

        <span class="c1"># from IPython.display import display</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_catalog_tables</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;tableName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">table_name</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># not found</span>
            <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># if logger.getEffectiveLevel() == logging.DEBUG:</span>
        <span class="c1">#     display(df)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">force_recreate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drop_catalog_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regular_tables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">force_recreate</span><span class="p">:</span>
            <span class="n">sql_stmt_create</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sql_stmt_create_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">cos_in</span><span class="o">=</span><span class="n">cos_url</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">sql_stmt_create</span><span class="p">)</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_sql</span><span class="p">(</span><span class="n">sql_stmt_create</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">job_id</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SQLClient.get_catalog_table_partitioned"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_catalog_table_partitioned">[docs]</a>    <span class="k">def</span> <span class="nf">get_catalog_table_partitioned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">table_name</span><span class="p">,</span>
                                      <span class="n">cos_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">force_recreate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a partitioned catalog table. We need to call `refresh_cache_table_partitioned`</span>

<span class="sd">        Parameters</span>
<span class="sd">        --------------</span>
<span class="sd">        table_name: str</span>
<span class="sd">            the name of the catalog table to be created</span>

<span class="sd">        cos_url : str, optional</span>
<span class="sd">            The COS URL from which the catalog table should reference to</span>
<span class="sd">            If not provided, it uses the internal `self.cos_in_url`</span>

<span class="sd">        force_recreate: bool</span>
<span class="sd">            (True) force to recreate an existing catalog table</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_catalog_table_name</span> <span class="o">=</span> <span class="n">table_name</span>

        <span class="k">if</span> <span class="n">cos_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cos_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos_in_url_partitioned</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_catalog_tables</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;tableName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">table_name</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># not found</span>
            <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">force_recreate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drop_catalog_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partitioned_tables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">force_recreate</span><span class="p">:</span>
            <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># auto-detection of scheme</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sql_stmt_create_partitioned_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                CREATE TABLE </span><span class="si">{table_name}</span><span class="s2"></span>
<span class="s2">                USING CSV</span>
<span class="s2">                LOCATION </span><span class="si">{cos_in}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="n">sql_stmt_create_partitioned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sql_stmt_create_partitioned_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">cos_in</span><span class="o">=</span><span class="n">cos_url</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># explit selection of scheme -&gt; need to tell &quot;PARTITIONED BY&quot;</span>
                <span class="n">sql_stmt_create_partitioned</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                CREATE TABLE </span><span class="si">{table_name}</span><span class="s2"> (</span>
<span class="s2">                customerID string,</span>
<span class="s2">                companyName string,</span>
<span class="s2">                contactName string,</span>
<span class="s2">                contactTitle string,</span>
<span class="s2">                address string,</span>
<span class="s2">                region string,</span>
<span class="s2">                postalCode string,</span>
<span class="s2">                country string,</span>
<span class="s2">                phone string,</span>
<span class="s2">                fax string</span>
<span class="s2">                )</span>
<span class="s2">                USING CSV</span>
<span class="s2">                PARTITIONED BY (country)</span>
<span class="s2">                LOCATION </span><span class="si">{cos_in}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">cos_in</span><span class="o">=</span><span class="n">cos_url</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">sql_stmt_create_partitioned</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt_create_partitioned</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_cache_table_partitioned</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.refresh_cache_table_partitioned"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.refresh_cache_table_partitioned">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_cache_table_partitioned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This step is required after creating a new partitioned catalog table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            table_name: str</span>
<span class="sd">                The partitioned table name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_catalog_table_name</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="c1"># if table_name not in self.partitioned_tables:</span>
        <span class="c1">#     logger.error(&quot;Table %s is not a partitioned table&quot; % (table_name))</span>
        <span class="c1">#     logger.error(&quot;.... [ %s ]&quot; %</span>
        <span class="c1">#                  &quot; &quot;.join(list({k: 1</span>
        <span class="c1">#                                 for k in self.partitioned_tables})))</span>
        <span class="c1">#     assert (0)</span>

        <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;ALTER TABLE </span><span class="si">{table_name}</span><span class="s2"> RECOVER PARTITIONS</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">query_until_success</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">):</span>
            <span class="n">select_full_status</span> <span class="o">=</span> <span class="s2">&quot;failed&quot;</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_count</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="n">max_count</span><span class="p">)</span> <span class="ow">and</span> <span class="n">select_full_status</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>
                <span class="n">select_full_job_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>
                <span class="n">select_full_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">wait_for_job</span><span class="p">(</span>
                    <span class="n">select_full_job_id</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;... </span><span class="si">%i</span><span class="s2">-th: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">select_full_status</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... </span><span class="si">%i</span><span class="s2">-th: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">select_full_status</span><span class="p">))</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># TUAN - current SQL Query bug, need to run a few times</span>
        <span class="n">query_until_success</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.get_schema_data"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_schema_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_schema_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cos_url</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the schema information</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cos_url : str</span>
<span class="sd">            The COS URL where data is stored</span>
<span class="sd">        type : str, optional</span>
<span class="sd">            The format type of the data, default is &#39;json&#39;</span>
<span class="sd">            Use from [&#39;json&#39;, &#39;csv&#39;, &#39;parquet&#39;] with case-insensitive</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DataFrame</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;JSON&quot;</span><span class="p">,</span> <span class="s2">&quot;CSV&quot;</span><span class="p">,</span> <span class="s2">&quot;PARQUET&quot;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;use wrong format&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Use wrong format of data: &#39;type&#39; option&quot;</span><span class="p">)</span>
        <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT * FROM DESCRIBE(</span><span class="si">{cos_in}</span><span class="s2"> STORED AS </span><span class="si">{type}</span><span class="s2">)</span>
<span class="s2">        INTO </span><span class="si">{cos_out}</span><span class="s2"> STORED AS JSON</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cos_in</span><span class="o">=</span><span class="n">cos_url</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">cos_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqlClient</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.describe_table"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.describe_table">[docs]</a>    <span class="k">def</span> <span class="nf">describe_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        DESCRIBE TABLE </span><span class="si">{table_name}</span><span class="s2"> INTO </span><span class="si">{cos_out}</span><span class="s2"> STORED AS CSV&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">cos_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">,</span> <span class="n">get_result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="SQLClient.initiate_data_skipping"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.initiate_data_skipping">[docs]</a>    <span class="k">def</span> <span class="nf">initiate_data_skipping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cos_out</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Before creating indexes, define the base location in COS to store them by using the following command:</span>

<span class="sd">        Parameters</span>
<span class="sd">        --------------</span>
<span class="sd">        cos_out: str</span>
<span class="sd">            The COS URL where the index metadata data are stored</span>

<span class="sd">        note</span>
<span class="sd">        -----</span>
<span class="sd">        * Metadata should not be stored under the path where the data is stored to avoid schema conflicts.</span>
<span class="sd">        * Make sure you use a path where you have write access if you need to create, refresh, or delete indexes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;ALTER METAINDEX SET LOCATION </span><span class="si">{cos_out}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cos_out</span><span class="o">=</span><span class="n">cos_out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sql_stmt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
            <span class="n">sql_stmt</span> <span class="o">=</span> <span class="n">sql_stmt</span> <span class="o">+</span> <span class="s2">&quot;/index/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span></div>


<div class="viewcode-block" id="SQLClient.get_data_skipping"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.get_data_skipping">[docs]</a>    <span class="k">def</span> <span class="nf">get_data_skipping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cos_out_url</span><span class="p">,</span> <span class="n">meta_summary</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One needs to decide which columns to index and choose an index type for each column</span>

<span class="sd">        Parameters</span>
<span class="sd">        --------------</span>
<span class="sd">        cos_out_url: str</span>
<span class="sd">            COS url should specify the top level (i.e., root) of the dataset. A unique index is built per dataset (identified by its root path)</span>

<span class="sd">        Note</span>
<span class="sd">        -------</span>
<span class="sd">        * Two users with different SQL Query accounts create independent indexes on the same dataset.</span>
<span class="sd">        * Once a data skipping index has been created, it is automatically used by SQL Query when running queries.</span>

<span class="sd">        `references &lt;https://www.ibm.com/cloud/blog/data-skipping-for-ibm-cloud-sql-query&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_summary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">meta_summary</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            MINMAX FOR temp,</span>
<span class="s2">            GEOSPATIAL FOR lat, lng,</span>
<span class="s2">            VALUELIST FOR city</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">splits</span> <span class="o">=</span> <span class="n">meta_summary</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">accepted_funcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MINMAX&quot;</span><span class="p">,</span>  <span class="s2">&quot;BLOOMFILTER&quot;</span><span class="p">,</span> <span class="s2">&quot;VALUELIST&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">phrase</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">:</span>
            <span class="n">delimiter</span> <span class="o">=</span> <span class="s2">&quot; FOR &quot;</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">delimiter</span> <span class="ow">in</span> <span class="n">phrase</span><span class="p">)</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">phrase</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">accepted_funcs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cos_out_url</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cos_out_url</span> <span class="o">=</span> <span class="s2">&quot;cos://us-geo/sql/metergen STORED AS parquet&quot;</span>

        <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        CREATE METAINDEX</span>
<span class="s2">        </span><span class="si">{meta_summary}</span><span class="s2"></span>
<span class="s2">        ON </span><span class="si">{cos_out_url}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta_summary</span><span class="o">=</span><span class="n">meta_summary</span><span class="p">,</span> <span class="n">cos_out_url</span><span class="o">=</span><span class="n">cos_out_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span></div>

<div class="viewcode-block" id="SQLClient.analyze"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.SQLClient.analyze">[docs]</a>    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides some insights about the data layout from the current SQL statement</span>

<span class="sd">        Parameters</span>
<span class="sd">        -------------</span>
<span class="sd">        job_id : str</span>
<span class="sd">            The job ID</span>

<span class="sd">        todo</span>
<span class="sd">        ------</span>

<span class="sd">        1. new sql only when max_obj_size &gt; 300MB</span>
<span class="sd">        2. check if STORED AS is used, if not suggested adding to sql with PARQUET or JSON</span>
<span class="sd">        3. add PARITIONED ... not at the end, but right after STORED AS (which can be missing in original SQL)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BestPracticeContainer</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;SqlBestPractice&#39;</span><span class="p">,</span>
                                           <span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;max_objs&#39;</span><span class="p">])</span>
        <span class="n">best_practice</span> <span class="o">=</span> <span class="n">BestPracticeContainer</span><span class="p">(</span><span class="s2">&quot;128 MB&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;completed&#39;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Job </span><span class="si">{job_id}</span><span class="s2"> is </span><span class="si">{status}</span><span class="s2"> - no more insights&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">msg</span>

        <span class="n">cos_url</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;resultset_location&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cos_url</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Job </span><span class="si">{job_id}</span><span class="s2"> does not return anything - no more insights&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">msg</span>

        <span class="n">cos_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cos_summary</span><span class="p">(</span><span class="n">cos_url</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_total_objects</span><span class="p">():</span>
            <span class="c1"># total_objects = cos_result[&#39;total_objects&#39;]  #not exact</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_results</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="n">seriesObj</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
                                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Size&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">total_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seriesObj</span><span class="p">[</span><span class="n">seriesObj</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">total_objects</span>

        <span class="n">total_objects</span> <span class="o">=</span> <span class="n">get_total_objects</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">get_size_in_MB</span><span class="p">(</span><span class="n">size_info</span><span class="p">):</span>
            <span class="n">num</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">size_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;TB&quot;</span><span class="p">:</span> <span class="mi">1048576</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

            <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">:</span>
                <span class="n">size_MB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">*</span> <span class="n">mapping</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">size_MB</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">return</span> <span class="n">size_MB</span>

        <span class="n">largest_size_MB</span> <span class="o">=</span> <span class="n">get_size_in_MB</span><span class="p">(</span><span class="n">cos_result</span><span class="p">[</span><span class="s1">&#39;largest_object_size&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">largest_size_MB</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">best_practice</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Job </span><span class="si">{job_id}</span><span class="s2"> looks fine - no more insights&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">msg</span>

        <span class="n">total_volume_MB</span> <span class="o">=</span> <span class="n">get_size_in_MB</span><span class="p">(</span><span class="n">cos_result</span><span class="p">[</span><span class="s1">&#39;total_volume&#39;</span><span class="p">])</span>
        <span class="n">SqlContainer</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;SqlStatus&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;job_id&#39;</span><span class="p">,</span> <span class="s1">&#39;total_data_objects&#39;</span><span class="p">,</span> <span class="s1">&#39;total_volume&#39;</span><span class="p">,</span> <span class="s1">&#39;max_object_size&#39;</span>
        <span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">SqlContainer</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">total_objects</span><span class="p">,</span> <span class="n">total_volume_MB</span><span class="p">,</span>
                             <span class="n">largest_size_MB</span><span class="p">)</span>
        <span class="n">mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span>
            <span class="s2">&quot;total_objects&quot;</span><span class="p">:</span> <span class="n">total_objects</span><span class="p">,</span>
            <span class="s2">&quot;total_volume_MB&quot;</span><span class="p">:</span> <span class="n">total_volume_MB</span>
        <span class="p">}</span>
        <span class="n">msg_01</span> <span class="o">=</span> <span class="s2">&quot;Job </span><span class="si">{job_id}</span><span class="s2"> has </span><span class="si">{total_objects}</span><span class="s2"> object</span><span class="si">{s}</span><span class="s2">, with </span><span class="si">{total_volume_MB}</span><span class="s2"> MB in total.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="o">**</span><span class="n">mappings</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s2">&quot;s&quot;</span> <span class="k">if</span> <span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;total_objects&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;total_objects&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">msg_01</span> <span class="o">=</span> <span class="n">msg_01</span> <span class="o">+</span> <span class="s2">&quot; Current object size is ~ </span><span class="si">{size}</span><span class="s2"> MB&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">size</span><span class="o">=</span><span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;total_volume_MB&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mappings</span><span class="p">[</span><span class="s2">&quot;total_objects&quot;</span><span class="p">])</span>

        <span class="n">mappings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">best_practice</span><span class="o">.</span><span class="n">size</span><span class="p">}</span>
        <span class="n">msg_02</span> <span class="o">=</span> <span class="s2">&quot;Best practices: object sizes ~ </span><span class="si">{size}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">mappings</span><span class="p">)</span>

        <span class="n">mappings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;num_objs&quot;</span><span class="p">:</span>
            <span class="nb">min</span><span class="p">(</span><span class="n">best_practice</span><span class="o">.</span><span class="n">max_objs</span><span class="p">,</span>
                <span class="n">query</span><span class="o">.</span><span class="n">total_volume</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">best_practice</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="p">}</span>

        <span class="n">msg_03</span> <span class="o">=</span> <span class="s2">&quot;Current SQL:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{sql}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;statement&quot;</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">revise_storage</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="s2">&quot;parquet&quot;</span><span class="p">):</span>
            <span class="n">url_storage</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;INTO (cos)://[^\s]* STORED AS&#39;</span><span class="p">,</span> <span class="n">sql_stmt</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">url_storage</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">url_storage</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pre</span> <span class="o">=</span> <span class="n">sql_stmt</span><span class="p">[:</span><span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">post</span> <span class="o">=</span> <span class="n">sql_stmt</span><span class="p">[</span><span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="n">detected_storage</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[^\s]*&#39;</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">storage</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="n">detected_storage</span><span class="p">:</span>
                    <span class="n">post</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">detected_storage</span><span class="p">,</span> <span class="n">storage</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">sql_stmt</span> <span class="o">=</span> <span class="n">pre</span> <span class="o">+</span> <span class="n">post</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;INTO (cos)://[^\s]*&#39;</span><span class="p">,</span> <span class="n">sql_stmt</span><span class="p">)</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">sql_stmt</span> <span class="o">=</span> <span class="n">sql_stmt</span><span class="p">[:</span><span class="n">loc</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; STORED AS  &#39;</span> <span class="o">+</span> <span class="n">storage</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span>
                <span class="p">)</span> <span class="o">+</span> <span class="n">sql_stmt</span><span class="p">[</span><span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">sql_stmt</span>

        <span class="k">def</span> <span class="nf">msg_partition_into</span><span class="p">():</span>
            <span class="n">msg_sub</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">msg_sub</span><span class="p">[</span>
                <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Consider using: PARTITIONED INTO </span><span class="si">{num_objs}</span><span class="s2"> OBJECTS/BUCKETS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">mappings</span><span class="p">)</span>

            <span class="n">new_sql</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;statement&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;PARTITION&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_sql</span><span class="p">:</span>
                <span class="n">new_sql</span> <span class="o">=</span> <span class="n">format_sql</span><span class="p">(</span><span class="n">revise_storage</span><span class="p">(</span><span class="n">new_sql</span><span class="p">,</span> <span class="s2">&quot;parquet&quot;</span><span class="p">))</span>
                <span class="kn">import</span> <span class="nn">re</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s1">&#39;INTO (cos)://[^\s]*[\s]+STORED[\s]+AS[\s]+PARQUET&#39;</span><span class="p">,</span>
                    <span class="n">new_sql</span><span class="p">)</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_sql</span> <span class="o">=</span> <span class="n">new_sql</span><span class="p">[:</span>
                                  <span class="n">loc</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; PARTITIONED INTO </span><span class="si">{num_objs}</span><span class="s2"> OBJECTS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                      <span class="o">**</span><span class="n">mappings</span><span class="p">)</span> <span class="o">+</span> <span class="n">new_sql</span><span class="p">[</span><span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>

            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;rows_returned&quot;</span><span class="p">]</span>
            <span class="n">msg_sub</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Suggested SQL:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{sql}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">new_sql</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">msg_sub</span>

        <span class="k">def</span> <span class="nf">msg_partition_every</span><span class="p">():</span>
            <span class="n">msg_05</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">num_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;rows_returned&quot;</span><span class="p">])</span> <span class="o">/</span>
                <span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">total_volume</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">best_practice</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="n">msg_05</span><span class="p">[</span>
                <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Consider using: PARTITIONED EVERY </span><span class="si">{num_rows}</span><span class="s2"> ROWS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">mappings</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">=</span><span class="n">num_rows</span><span class="p">)</span>

            <span class="n">new_sql</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;statement&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;PARITION&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_sql</span><span class="p">:</span>
                <span class="c1"># new_sql = new_sql + &quot; PARTITIONED EVERY {num_rows} ROWS&quot;.format(</span>
                <span class="c1">#    **mappings, num_rows=num_rows)</span>
                <span class="n">new_sql</span> <span class="o">=</span> <span class="n">format_sql</span><span class="p">(</span><span class="n">revise_storage</span><span class="p">(</span><span class="n">new_sql</span><span class="p">,</span> <span class="s2">&quot;parquet&quot;</span><span class="p">))</span>
                <span class="kn">import</span> <span class="nn">re</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s1">&#39;INTO (cos)://[^\s]*[\s]+STORED[\s]+AS[\s]+PARQUET&#39;</span><span class="p">,</span>
                    <span class="n">new_sql</span><span class="p">)</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_sql</span> <span class="o">=</span> <span class="n">new_sql</span><span class="p">[:</span>
                                  <span class="n">loc</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; PARTITIONED EVERY </span><span class="si">{num_rows}</span><span class="s2"> ROWS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                      <span class="o">**</span><span class="n">mappings</span><span class="p">)</span> <span class="o">+</span> <span class="n">new_sql</span><span class="p">[</span><span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;rows_returned&quot;</span><span class="p">]</span>
            <span class="n">msg_05</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Suggested SQL:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{sql}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">new_sql</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">msg_05</span>

        <span class="n">msg_04</span> <span class="o">=</span> <span class="n">msg_partition_into</span><span class="p">()</span>
        <span class="n">msg_05</span> <span class="o">=</span> <span class="n">msg_partition_every</span><span class="p">()</span>
        <span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">msg_01</span><span class="p">,</span> <span class="n">msg_02</span><span class="p">,</span> <span class="n">msg_03</span><span class="p">]</span>
        <span class="n">my_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">msg_04</span><span class="p">)</span>
        <span class="n">my_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">msg_05</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">msg</span></div>

    <span class="k">def</span> <span class="nf">_get_ts_datasource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">time_stamp</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span>
                <span class="n">cos_out</span><span class="p">,</span> <span class="n">granularity</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="n">where_clause</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ops</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">num_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the data source for time-series in the next-query</span>

<span class="sd">        It will returns the data source in 3 columns: field_name, time_stamp, observation</span>

<span class="sd">        Parameters</span>
<span class="sd">        --------------</span>
<span class="sd">        table: str</span>
<span class="sd">            The catalog table name or the view-table that you generate from the WITH clause via :meth:`with_` method</span>
<span class="sd">        key: str</span>
<span class="sd">            The column name being used as the key, and is maped to `field_name`</span>
<span class="sd">        time_stamp: str</span>
<span class="sd">            The column name being used as timetick, and is mapped to `time_stamp`</span>
<span class="sd">        observation: str</span>
<span class="sd">            The column name being used as value, and is maped to `observation`</span>
<span class="sd">        cos_out: str</span>
<span class="sd">            The COS URL where the data is copied to - later as data source</span>
<span class="sd">        granularity: str</span>
<span class="sd">            a value in one of [&quot;raw&quot;, &quot;per_min&quot;, &quot;per_&lt;x&gt;min&quot;, &quot;per_sec&quot;, &quot;per_&lt;x&gt;sec&quot;, &quot;per_hour&quot;, &quot;per_&lt;x&gt;hour&quot;]</span>
<span class="sd">            with &lt;x&gt; is a number divided by 60, e.g. 10, 15</span>
<span class="sd">        ops: str</span>
<span class="sd">            The aggregation method: &quot;avg&quot;, &quot;sum&quot;, &quot;max&quot;, &quot;min&quot;, &quot;count&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        str</span>
<span class="sd">            The COS_URL where the data with 3 fields (key, time_stamp, observation)</span>
<span class="sd">            and can be digested into time-series via TIME_SERIES_FORMAT(key, timestick, value)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp_cos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos_out_url</span>
        <span class="k">if</span> <span class="n">num_objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">num_rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;provide at least `num_objects` or `num_rows`&quot;</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">granularity</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">granularity</span> <span class="o">==</span> <span class="s2">&quot;per_min&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">time_stamp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unixtime_columns</span><span class="p">:</span>
            <span class="c1">#  -- convert unix-time in ms to sec</span>
            <span class="n">time_info</span> <span class="o">=</span> <span class="s2">&quot;cast(</span><span class="si">{time_stamp}</span><span class="s2">/1000 as timestamp)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_stamp</span><span class="o">=</span><span class="n">time_stamp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_info</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{time_stamp}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_stamp</span><span class="o">=</span><span class="n">time_stamp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">granularity</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
            <span class="n">tmp_cos</span> <span class="o">=</span> <span class="n">cos_out</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">where_clause</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">extra_where</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extra_where</span> <span class="o">=</span> <span class="s2">&quot;AND &quot;</span> <span class="o">+</span> <span class="n">where_clause</span>

        <span class="k">if</span> <span class="n">num_objects</span><span class="p">:</span>
            <span class="n">partition_clause</span> <span class="o">=</span> <span class="s2">&quot;PARTITIONED INTO </span><span class="si">{x}</span><span class="s2"> OBJECTS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">num_objects</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">num_rows</span><span class="p">:</span>
            <span class="n">partition_clause</span> <span class="o">=</span> <span class="s2">&quot;PARTITIONED EVERY </span><span class="si">{x}</span><span class="s2"> ROWS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="n">select_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            SELECT </span><span class="si">{key}</span><span class="s2"> as field_name,</span>
<span class="s2">                </span><span class="si">{time_info}</span><span class="s2"> as time_stamp,</span>
<span class="s2">                </span><span class="si">{observation}</span><span class="s2"> as observation</span>
<span class="s2">            FROM </span><span class="si">{table_name}</span><span class="s2"></span>
<span class="s2">            WHERE isnotnull(</span><span class="si">{key}</span><span class="s2">) AND isnotnull(</span><span class="si">{observation}</span><span class="s2">)</span>
<span class="s2">            </span><span class="si">{extra_where}</span><span class="s2"></span>
<span class="s2">            INTO </span><span class="si">{cos_out}</span><span class="s2"> STORED AS PARQUET </span><span class="si">{partition_clause}</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">cos_out</span><span class="o">=</span><span class="n">tmp_cos</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="n">observation</span><span class="p">,</span> <span class="n">time_info</span><span class="o">=</span><span class="n">time_info</span><span class="p">,</span> <span class="n">extra_where</span><span class="o">=</span><span class="n">extra_where</span><span class="p">,</span>
                <span class="n">partition_clause</span><span class="o">=</span><span class="n">partition_clause</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_with_clause</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_select_clause</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sql_stmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_stmt</span> <span class="o">+</span> <span class="n">select_stmt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sql_stmt</span> <span class="o">=</span> <span class="n">select_stmt</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="n">print_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_stmt</span><span class="p">)</span>
            <span class="n">select_container_id_full_location</span> <span class="o">=</span> <span class="s2">&quot;cos://dry_run/&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_stmt</span><span class="p">)</span>
            <span class="n">select_container_id_full_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">job_id</span><span class="p">)[</span><span class="s1">&#39;resultset_location&#39;</span><span class="p">]</span>

        <span class="n">cos_in</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">granularity</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cos_in</span> <span class="o">=</span> <span class="n">select_container_id_full_location</span>

        <span class="k">def</span> <span class="nf">query_min</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            return:</span>
<span class="sd">                None or &#39;result&#39;</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="n">cos_in</span>
            <span class="kn">import</span> <span class="nn">re</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;per_[0-9]*min&#39;</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;per_[0-9]+min&#39;</span><span class="p">)</span>
            <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span>
            <span class="n">num_min</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">granularity</span><span class="p">):</span>
                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;minute&quot;</span>
                <span class="k">if</span> <span class="n">p2</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">granularity</span><span class="p">):</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)</span>
                    <span class="n">num_min</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">temp</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">assert</span><span class="p">(</span><span class="mi">60</span> <span class="o">%</span> <span class="n">num_min</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="s2">&quot;minute&quot;</span><span class="p">:</span>
                <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                select</span>
<span class="s2">                    field_name,</span>
<span class="s2">                    to_date(time_stamp) as time_stamp_date,</span>
<span class="s2">                    hour(time_stamp) as time_stamp_hour,</span>
<span class="s2">                    (floor(minute(time_stamp)/</span><span class="si">{num_min}</span><span class="s2">)) * </span><span class="si">{num_min}</span><span class="s2"> as time_stamp_minute, -- within [current, current+</span><span class="si">{num_min}</span><span class="s2">) minute time-window</span>
<span class="s2">                    </span><span class="si">{ops}</span><span class="s2">(observation) as </span><span class="si">{observation}</span><span class="s2"></span>
<span class="s2">                from </span><span class="si">{cos_in}</span><span class="s2"> stored as parquet</span>
<span class="s2">                group by field_name,  to_date(time_stamp), hour(time_stamp), (floor(minute(time_stamp)/</span><span class="si">{num_min}</span><span class="s2">)) * </span><span class="si">{num_min}</span><span class="s2"></span>
<span class="s2">                INTO </span><span class="si">{cos_out}</span><span class="s2"> STORED AS PARQUET </span><span class="si">{partition_clause}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cos_in</span><span class="o">=</span><span class="n">cos_in</span><span class="p">,</span> <span class="n">cos_out</span><span class="o">=</span><span class="n">tmp_cos</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="n">observation</span><span class="p">,</span> <span class="n">time_info</span><span class="o">=</span><span class="n">time_info</span><span class="p">,</span> <span class="n">num_min</span><span class="o">=</span><span class="n">num_min</span><span class="p">,</span>
                    <span class="n">partition_clause</span><span class="o">=</span><span class="n">partition_clause</span><span class="p">,</span> <span class="n">ops</span><span class="o">=</span><span class="n">ops</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                    <span class="n">print_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>

                <span class="c1"># Restore timestamp as single column</span>
                <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                    <span class="n">cos_in</span> <span class="o">=</span> <span class="s2">&quot;cos://dry_run/&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cos_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">job_id</span><span class="p">)[</span><span class="s1">&#39;resultset_location&#39;</span><span class="p">]</span>
                <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                select</span>
<span class="s2">                    field_name, -- as </span><span class="si">{key}</span><span class="s2">,</span>
<span class="s2">                    to_timestamp(concat(date(time_stamp_date), &quot; &quot;, time_stamp_hour, &quot;:&quot;, time_stamp_minute), &quot;yyyy-MM-dd HH:mm&quot;) as time_stamp,</span>
<span class="s2">                    </span><span class="si">{observation}</span><span class="s2"> as observation</span>
<span class="s2">                from </span><span class="si">{cos_in}</span><span class="s2"> stored as parquet</span>
<span class="s2">                INTO </span><span class="si">{cos_out}</span><span class="s2"> STORED AS PARQUET </span><span class="si">{partition_clause}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cos_in</span><span class="o">=</span><span class="n">cos_in</span><span class="p">,</span> <span class="n">cos_out</span><span class="o">=</span><span class="n">cos_out</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="n">observation</span><span class="p">,</span> <span class="n">time_info</span><span class="o">=</span><span class="n">time_info</span><span class="p">,</span>
                    <span class="n">partition_clause</span><span class="o">=</span><span class="n">partition_clause</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                    <span class="n">print_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">def</span> <span class="nf">query_sec</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            return:</span>
<span class="sd">                None or &#39;result&#39;</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="kn">import</span> <span class="nn">re</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;per_[0-9]*sec&#39;</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;per_[0-9]+sec&#39;</span><span class="p">)</span>
            <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span>
            <span class="n">num_sec</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">granularity</span><span class="p">):</span>
                <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;sec&quot;</span>
                <span class="k">if</span> <span class="n">p2</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">granularity</span><span class="p">):</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)</span>
                    <span class="n">num_sec</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">temp</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">assert</span><span class="p">(</span><span class="mi">60</span> <span class="o">%</span> <span class="n">num_sec</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="s2">&quot;sec&quot;</span><span class="p">:</span>
                <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                select</span>
<span class="s2">                    field_name,</span>
<span class="s2">                    to_date(time_stamp) as time_stamp_date,</span>
<span class="s2">                    hour(time_stamp) as time_stamp_hour,</span>
<span class="s2">                    minute(time_stamp) as time_stamp_minute,</span>
<span class="s2">                    (floor(second(time_stamp)/</span><span class="si">{num_sec}</span><span class="s2">)) * </span><span class="si">{num_sec}</span><span class="s2"> as time_stamp_second, -- within [current, current+</span><span class="si">{num_sec}</span><span class="s2">) second time-window</span>
<span class="s2">                    </span><span class="si">{ops}</span><span class="s2">(observation) as </span><span class="si">{observation}</span><span class="s2"></span>
<span class="s2">                from </span><span class="si">{cos_in}</span><span class="s2"> stored as parquet</span>
<span class="s2">                group by field_name,  to_date(time_stamp), hour(time_stamp), minute(time_stamp), (floor(second(time_stamp)/</span><span class="si">{num_sec}</span><span class="s2">)) * </span><span class="si">{num_sec}</span><span class="s2"></span>
<span class="s2">                INTO </span><span class="si">{cos_out}</span><span class="s2"> STORED AS PARQUET </span><span class="si">{partition_clause}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cos_in</span><span class="o">=</span><span class="n">cos_in</span><span class="p">,</span> <span class="n">cos_out</span><span class="o">=</span><span class="n">tmp_cos</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="n">observation</span><span class="p">,</span> <span class="n">time_info</span><span class="o">=</span><span class="n">time_info</span><span class="p">,</span> <span class="n">num_sec</span><span class="o">=</span><span class="n">num_sec</span><span class="p">,</span>
                    <span class="n">partition_clause</span><span class="o">=</span><span class="n">partition_clause</span><span class="p">,</span> <span class="n">ops</span><span class="o">=</span><span class="n">ops</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                    <span class="n">print_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>

                <span class="c1"># Restore timestamp as single column</span>
                <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                    <span class="n">init_cos</span> <span class="o">=</span> <span class="s2">&quot;cos://dry_run/&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">init_cos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">job_id</span><span class="p">)[</span><span class="s1">&#39;resultset_location&#39;</span><span class="p">]</span>
                <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                select</span>
<span class="s2">                    field_name, -- as </span><span class="si">{key}</span><span class="s2">,</span>
<span class="s2">                    to_timestamp(concat(date(time_stamp_date), &quot; &quot;, &quot;:&quot;.join([time_stamp_hour, time_stamp_minute, time_stamp_second]), &quot;yyyy-MM-dd HH:mm:ss&quot;) as time_stamp,</span>
<span class="s2">                    </span><span class="si">{observation}</span><span class="s2"> as observation</span>
<span class="s2">                from </span><span class="si">{cos_in}</span><span class="s2"> stored as parquet</span>
<span class="s2">                INTO </span><span class="si">{cos_out}</span><span class="s2"> STORED AS PARQUET </span><span class="si">{partition_clause}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cos_in</span><span class="o">=</span><span class="n">cos_in</span><span class="p">,</span> <span class="n">cos_out</span><span class="o">=</span><span class="n">cos_out</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="n">observation</span><span class="p">,</span> <span class="n">time_info</span><span class="o">=</span><span class="n">time_info</span><span class="p">,</span>
                    <span class="n">partition_clause</span><span class="o">=</span><span class="n">partition_clause</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
                    <span class="n">print_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_sql</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">query_min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">query_sec</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="submit_sql_with_checking_saved_jobs"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.submit_sql_with_checking_saved_jobs">[docs]</a><span class="nd">@check_saved_jobs_decorator</span>
<span class="k">def</span> <span class="nf">submit_sql_with_checking_saved_jobs</span><span class="p">(</span><span class="n">sql_stmt</span><span class="p">,</span>
                                        <span class="n">pagesize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="n">blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;POST /v2/sql_jobs?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 201 None</span>
<span class="sd">DEBUG:cloud_utilities.sql_query:{&#39;job_id&#39;: &#39;29d6ff44-fb0d-4a16-95e7-3235b0b0dd56&#39;, &#39;status&#39;: &#39;queued&#39;}</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:cloud_utilities.sql_query:Job 29d6ff44-fb0d-4a16-95e7-3235b0b0dd56 terminated with status: completed</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.sql-query.cloud.ibm.com:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://api.sql-query.cloud.ibm.com:443 &quot;GET /v2/sql_jobs/29d6ff44-fb0d-4a16-95e7-3235b0b0dd56?instance_crn=crn:v1:bluemix:public:sql-query:us-south:a/7686fcbb40f3887bab725f8c42928c23:9daec8d2-9641-429f-9ceb-675d1c092841:: HTTP/1.1&quot; 200 None</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): s3.us-south.cloud-object-storage.appdomain.cloud:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://s3.us-south.cloud-object-storage.appdomain.cloud:443 &quot;GET /sql-query-cos-access-ts?prefix=jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56 HTTP/1.1&quot; 200 1532</span>
<span class="sd">DEBUG:ibm_botocore.loaders:Loading JSON file: /opt/conda/envs/Python36/lib/python3.6/site-packages/ibm_botocore/data/endpoints.json</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event choose-service-name: calling handler &lt;function handle_service_name_alias at 0x7fdbb9640d08&gt;</span>
<span class="sd">DEBUG:ibm_botocore.loaders:Loading JSON file: /opt/conda/envs/Python36/lib/python3.6/site-packages/ibm_botocore/data/s3/2006-03-01/service-2.json</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event creating-client-class.s3: calling handler &lt;function add_generate_presigned_post at 0x7fdbb967f8c8&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event creating-client-class.s3: calling handler &lt;function lazy_call.&lt;locals&gt;._handler at 0x7fdbb89cbae8&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event creating-client-class.s3: calling handler &lt;function add_generate_presigned_url at 0x7fdbb967f6a8&gt;</span>
<span class="sd">DEBUG:ibm_botocore.args:The s3 config key is not a dictionary type, ignoring its value of: None</span>
<span class="sd">DEBUG:ibm_botocore.endpoint:Setting s3 timeout as (60, 60)</span>
<span class="sd">DEBUG:ibm_botocore.loaders:Loading JSON file: /opt/conda/envs/Python36/lib/python3.6/site-packages/ibm_botocore/data/_retry.json</span>
<span class="sd">DEBUG:ibm_botocore.client:Registering retry handlers for service: s3</span>
<span class="sd">DEBUG:ibm_botocore.client:Using S3 path style addressing.</span>
<span class="sd">DEBUG:ibm_s3transfer.utils:Acquiring 0</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:DownloadSubmissionTask(transfer_id=0, {&#39;transfer_future&#39;: &lt;ibm_s3transfer.futures.TransferFuture object at 0x7fdba8230400&gt;}) about to wait for the following futures []</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:DownloadSubmissionTask(transfer_id=0, {&#39;transfer_future&#39;: &lt;ibm_s3transfer.futures.TransferFuture object at 0x7fdba8230400&gt;}) done waiting for dependent futures</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:Executing task DownloadSubmissionTask(transfer_id=0, {&#39;transfer_future&#39;: &lt;ibm_s3transfer.futures.TransferFuture object at 0x7fdba8230400&gt;}) with kwargs {&#39;client&#39;: &lt;ibm_botocore.client.S3 object at 0x7fdba8283b38&gt;, &#39;config&#39;: &lt;ibm_boto3.s3.transfer.TransferConfig object at 0x7fdba829fb00&gt;, &#39;osutil&#39;: &lt;ibm_s3transfer.utils.OSUtils object at 0x7fdba829fa58&gt;, &#39;request_executor&#39;: &lt;ibm_s3transfer.futures.BoundedExecutor object at 0x7fdba829fc88&gt;, &#39;transfer_future&#39;: &lt;ibm_s3transfer.futures.TransferFuture object at 0x7fdba8230400&gt;, &#39;io_executor&#39;: &lt;ibm_s3transfer.futures.BoundedExecutor object at 0x7fdba82300b8&gt;}</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.HeadObject: calling handler &lt;function sse_md5 at 0x7fdbb95dc598&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.HeadObject: calling handler &lt;function validate_bucket_name at 0x7fdbb95dc510&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.HeadObject: calling handler &lt;bound method S3RegionRedirector.redirect_from_cache of &lt;ibm_botocore.utils.S3RegionRedirector object at 0x7fdba829f278&gt;&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.HeadObject: calling handler &lt;function generate_idempotent_uuid at 0x7fdbb95dc158&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-call.s3.HeadObject: calling handler &lt;function add_expect_header at 0x7fdbb95dc9d8&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-call.s3.HeadObject: calling handler &lt;bound method S3RegionRedirector.set_request_url of &lt;ibm_botocore.utils.S3RegionRedirector object at 0x7fdba829f278&gt;&gt;</span>
<span class="sd">DEBUG:ibm_botocore.endpoint:Making request for OperationModel(name=HeadObject) with params: {&#39;url_path&#39;: &#39;/sql-query-cos-access-ts/jobid%3D29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;query_string&#39;: {}, &#39;method&#39;: &#39;HEAD&#39;, &#39;headers&#39;: {&#39;User-Agent&#39;: &#39;ibm-cos-sdk-python/2.4.3 Python/3.6.9 Linux/4.4.0-174-generic ibm-cos-sdk-python-core/2.4.3&#39;}, &#39;body&#39;: b&#39;&#39;, &#39;url&#39;: &#39;https://s3.us-south.cloud-object-storage.appdomain.cloud/sql-query-cos-access-ts/jobid%3D29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;context&#39;: {&#39;client_region&#39;: &#39;us-east-1&#39;, &#39;client_config&#39;: &lt;ibm_botocore.config.Config object at 0x7fdba8283f28&gt;, &#39;has_streaming_input&#39;: False, &#39;auth_type&#39;: None, &#39;signing&#39;: {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;}}}</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event request-created.s3.HeadObject: calling handler &lt;function signal_not_transferring at 0x7fdbb93876a8&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event request-created.s3.HeadObject: calling handler &lt;bound method RequestSigner.handler of &lt;ibm_botocore.signers.RequestSigner object at 0x7fdba8283c88&gt;&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event choose-signer.s3.HeadObject: calling handler &lt;function set_operation_specific_signer at 0x7fdbb95dc048&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event request-created.s3.HeadObject: calling handler &lt;function signal_transferring at 0x7fdbb9387730&gt;</span>
<span class="sd">DEBUG:ibm_botocore.endpoint:Sending http request: &lt;AWSPreparedRequest stream_output=False, method=HEAD, url=https://s3.us-south.cloud-object-storage.appdomain.cloud/sql-query-cos-access-ts/jobid%3D29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet, headers={&#39;User-Agent&#39;: b&#39;ibm-cos-sdk-python/2.4.3 Python/3.6.9 Linux/4.4.0-174-generic ibm-cos-sdk-python-core/2.4.3&#39;, &#39;Authorization&#39;: b&#39;Bearer eyJraWQiOiIyMDIwMDIyNTE4MjgiLCJhbGciOiJSUzI1NiJ9.eyJpYW1faWQiOiJJQk1pZC0yNzAwMDQwQjJRIiwiaWQiOiJJQk1pZC0yNzAwMDQwQjJRIiwicmVhbG1pZCI6IklCTWlkIiwiaWRlbnRpZmllciI6IjI3MDAwNDBCMlEiLCJnaXZlbl9uYW1lIjoiUmFnaHUiLCJmYW1pbHlfbmFtZSI6IkdhbnRpIiwibmFtZSI6IlJhZ2h1IEdhbnRpIiwiZW1haWwiOiJyZ2FudGlAdXMuaWJtLmNvbSIsInN1YiI6InJnYW50aUB1cy5pYm0uY29tIiwiYWNjb3VudCI6eyJ2YWxpZCI6dHJ1ZSwiYnNzIjoiNzY4NmZjYmI0MGYzODg3YmFiNzI1ZjhjNDI5MjhjMjMiLCJpbXNfdXNlcl9pZCI6IjcyMzQ5ODEiLCJpbXMiOiIxNzE2NTcxIn0sImlhdCI6MTU4NTE3NDU1MCwiZXhwIjoxNTg1MTc4MTUwLCJpc3MiOiJodHRwczovL2lhbS5uZy5ibHVlbWl4Lm5ldC9vaWRjL3Rva2VuIiwiZ3JhbnRfdHlwZSI6InVybjppYm06cGFyYW1zOm9hdXRoOmdyYW50LXR5cGU6YXBpa2V5Iiwic2NvcGUiOiJpYm0gb3BlbmlkIiwiY2xpZW50X2lkIjoiYngiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.aH3thJ5MHMg_mELog79yoanjFddFz2D0YV2hmEgutZo_DgySwRJ_VHlDepAhcywlhC1_CFaEy4CQeZOcf9NHYhGfj9rxQkB6LqO-1T5Sljzl-l-HEUb2O_RuPaDmSI9thOscF8wDjyhv_nJTkFfOtHrHQQ_9hbkUg2PGnmbGJwgd4qjIEKJ0-pzHmhjC2kRuwZt4gTE6xsZJf_JYnWBUXTW3X6uLfF0k1G2INJFwL25gw_XamQfx4-lccJ_eUIESvYNg5jCWI9ymrmfFVodxFy_sFhgBPOhktid95FFu38ioeQLBnuFeLWyr6v9QVjtkMq2FGuuF33HpdYYsQVmAoQ&#39;}&gt;</span>
<span class="sd">DEBUG:urllib3.util.retry:Converted retries value: False -&gt; Retry(total=False, connect=None, read=None, redirect=0, status=None)</span>
<span class="sd">DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): s3.us-south.cloud-object-storage.appdomain.cloud:443</span>
<span class="sd">DEBUG:urllib3.connectionpool:https://s3.us-south.cloud-object-storage.appdomain.cloud:443 &quot;HEAD /sql-query-cos-access-ts/jobid%3D29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet HTTP/1.1&quot; 200 0</span>
<span class="sd">DEBUG:ibm_botocore.parsers:Response headers: {&#39;Date&#39;: &#39;Wed, 25 Mar 2020 22:25:30 GMT&#39;, &#39;X-Clv-Request-Id&#39;: &#39;96230709-9b61-42ba-bca1-24785988594f&#39;, &#39;Server&#39;: &#39;Cleversafe/3.14.9.67&#39;, &#39;X-Clv-S3-Version&#39;: &#39;2.5&#39;, &#39;Accept-Ranges&#39;: &#39;bytes&#39;, &#39;x-amz-request-id&#39;: &#39;96230709-9b61-42ba-bca1-24785988594f&#39;, &#39;x-amz-mp-parts-count&#39;: &#39;46&#39;, &#39;ETag&#39;: &#39;&quot;620f5b863825c7b47bc98eb021e47994-46&quot;&#39;, &#39;Content-Type&#39;: &#39;application/octet-stream&#39;, &#39;Last-Modified&#39;: &#39;Wed, 25 Mar 2020 22:25:25 GMT&#39;, &#39;Content-Length&#39;: &#39;4719257338&#39;}</span>
<span class="sd">DEBUG:ibm_botocore.parsers:Response body:</span>
<span class="sd">b&#39;&#39;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event needs-retry.s3.HeadObject: calling handler &lt;ibm_botocore.retryhandler.RetryHandler object at 0x7fdba829f3c8&gt;</span>
<span class="sd">DEBUG:ibm_botocore.retryhandler:No retry needed.</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event needs-retry.s3.HeadObject: calling handler &lt;bound method S3RegionRedirector.redirect_from_error of &lt;ibm_botocore.utils.S3RegionRedirector object at 0x7fdba829f278&gt;&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.futures:Submitting task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=0-8388607&#39;}}) to executor &lt;ibm_s3transfer.futures.BoundedExecutor object at 0x7fdba829fc88&gt; for transfer request: 0.</span>
<span class="sd">DEBUG:ibm_s3transfer.utils:Acquiring 0</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=0-8388607&#39;}}) about to wait for the following futures []</span>
<span class="sd">DEBUG:ibm_s3transfer.futures:Submitting task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=8388608-16777215&#39;}}) to executor &lt;ibm_s3transfer.futures.BoundedExecutor object at 0x7fdba829fc88&gt; for transfer request: 0.</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=0-8388607&#39;}}) done waiting for dependent futures</span>
<span class="sd">DEBUG:ibm_s3transfer.utils:Acquiring 0</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:Executing task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=0-8388607&#39;}}) with kwargs {&#39;client&#39;: &lt;ibm_botocore.client.S3 object at 0x7fdba8283b38&gt;, &#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;fileobj&#39;: &lt;ibm_s3transfer.utils.DeferredOpenFile object at 0x7fdba82456d8&gt;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=0-8388607&#39;}, &#39;callbacks&#39;: [], &#39;max_attempts&#39;: 5, &#39;start_index&#39;: 0, &#39;download_output_manager&#39;: &lt;ibm_s3transfer.download.DownloadFilenameOutputManager object at 0x7fdba82454a8&gt;, &#39;io_chunksize&#39;: 262144, &#39;bandwidth_limiter&#39;: None}</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function sse_md5 at 0x7fdbb95dc598&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.futures:Submitting task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=16777216-25165823&#39;}}) to executor &lt;ibm_s3transfer.futures.BoundedExecutor object at 0x7fdba829fc88&gt; for transfer request: 0.</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=8388608-16777215&#39;}}) about to wait for the following futures []</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=8388608-16777215&#39;}}) done waiting for dependent futures</span>
<span class="sd">DEBUG:ibm_s3transfer.utils:Acquiring 0</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function validate_bucket_name at 0x7fdbb95dc510&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;bound method S3RegionRedirector.redirect_from_cache of &lt;ibm_botocore.utils.S3RegionRedirector object at 0x7fdba829f278&gt;&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function generate_idempotent_uuid at 0x7fdbb95dc158&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.futures:Submitting task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=25165824-33554431&#39;}}) to executor &lt;ibm_s3transfer.futures.BoundedExecutor object at 0x7fdba829fc88&gt; for transfer request: 0.</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:Executing task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=8388608-16777215&#39;}}) with kwargs {&#39;client&#39;: &lt;ibm_botocore.client.S3 object at 0x7fdba8283b38&gt;, &#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;fileobj&#39;: &lt;ibm_s3transfer.utils.DeferredOpenFile object at 0x7fdba82456d8&gt;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=8388608-16777215&#39;}, &#39;callbacks&#39;: [], &#39;max_attempts&#39;: 5, &#39;start_index&#39;: 8388608, &#39;download_output_manager&#39;: &lt;ibm_s3transfer.download.DownloadFilenameOutputManager object at 0x7fdba82454a8&gt;, &#39;io_chunksize&#39;: 262144, &#39;bandwidth_limiter&#39;: None}</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=16777216-25165823&#39;}}) about to wait for the following futures []</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-call.s3.GetObject: calling handler &lt;function add_expect_header at 0x7fdbb95dc9d8&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.utils:Acquiring 0</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function sse_md5 at 0x7fdbb95dc598&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=16777216-25165823&#39;}}) done waiting for dependent futures</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-call.s3.GetObject: calling handler &lt;bound method S3RegionRedirector.set_request_url of &lt;ibm_botocore.utils.S3RegionRedirector object at 0x7fdba829f278&gt;&gt;</span>
<span class="sd">DEBUG:ibm_botocore.endpoint:Making request for OperationModel(name=GetObject) with params: {&#39;url_path&#39;: &#39;/sql-query-cos-access-ts/jobid%3D29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;query_string&#39;: {}, &#39;method&#39;: &#39;GET&#39;, &#39;headers&#39;: {&#39;Range&#39;: &#39;bytes=0-8388607&#39;, &#39;User-Agent&#39;: &#39;ibm-cos-sdk-python/2.4.3 Python/3.6.9 Linux/4.4.0-174-generic ibm-cos-sdk-python-core/2.4.3&#39;}, &#39;body&#39;: b&#39;&#39;, &#39;url&#39;: &#39;https://s3.us-south.cloud-object-storage.appdomain.cloud/sql-query-cos-access-ts/jobid%3D29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;context&#39;: {&#39;client_region&#39;: &#39;us-east-1&#39;, &#39;client_config&#39;: &lt;ibm_botocore.config.Config object at 0x7fdba8283f28&gt;, &#39;has_streaming_input&#39;: False, &#39;auth_type&#39;: None, &#39;signing&#39;: {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;}}}</span>
<span class="sd">DEBUG:ibm_s3transfer.futures:Submitting task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=33554432-41943039&#39;}}) to executor &lt;ibm_s3transfer.futures.BoundedExecutor object at 0x7fdba829fc88&gt; for transfer request: 0.</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function validate_bucket_name at 0x7fdbb95dc510&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:Executing task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=16777216-25165823&#39;}}) with kwargs {&#39;client&#39;: &lt;ibm_botocore.client.S3 object at 0x7fdba8283b38&gt;, &#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;fileobj&#39;: &lt;ibm_s3transfer.utils.DeferredOpenFile object at 0x7fdba82456d8&gt;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=16777216-25165823&#39;}, &#39;callbacks&#39;: [], &#39;max_attempts&#39;: 5, &#39;start_index&#39;: 16777216, &#39;download_output_manager&#39;: &lt;ibm_s3transfer.download.DownloadFilenameOutputManager object at 0x7fdba82454a8&gt;, &#39;io_chunksize&#39;: 262144, &#39;bandwidth_limiter&#39;: None}</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=25165824-33554431&#39;}}) about to wait for the following futures []</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=25165824-33554431&#39;}}) done waiting for dependent futures</span>
<span class="sd">DEBUG:ibm_s3transfer.utils:Acquiring 0</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;bound method S3RegionRedirector.redirect_from_cache of &lt;ibm_botocore.utils.S3RegionRedirector object at 0x7fdba829f278&gt;&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function sse_md5 at 0x7fdbb95dc598&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event request-created.s3.GetObject: calling handler &lt;function signal_not_transferring at 0x7fdbb93876a8&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event request-created.s3.GetObject: calling handler &lt;bound method RequestSigner.handler of &lt;ibm_botocore.signers.RequestSigner object at 0x7fdba8283c88&gt;&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=33554432-41943039&#39;}}) about to wait for the following futures []</span>
<span class="sd">DEBUG:ibm_s3transfer.futures:Submitting task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=41943040-50331647&#39;}}) to executor &lt;ibm_s3transfer.futures.BoundedExecutor object at 0x7fdba829fc88&gt; for transfer request: 0.</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function generate_idempotent_uuid at 0x7fdbb95dc158&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function validate_bucket_name at 0x7fdbb95dc510&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:Executing task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=25165824-33554431&#39;}}) with kwargs {&#39;client&#39;: &lt;ibm_botocore.client.S3 object at 0x7fdba8283b38&gt;, &#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;fileobj&#39;: &lt;ibm_s3transfer.utils.DeferredOpenFile object at 0x7fdba82456d8&gt;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=25165824-33554431&#39;}, &#39;callbacks&#39;: [], &#39;max_attempts&#39;: 5, &#39;start_index&#39;: 25165824, &#39;download_output_manager&#39;: &lt;ibm_s3transfer.download.DownloadFilenameOutputManager object at 0x7fdba82454a8&gt;, &#39;io_chunksize&#39;: 262144, &#39;bandwidth_limiter&#39;: None}</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function sse_md5 at 0x7fdbb95dc598&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=33554432-41943039&#39;}}) done waiting for dependent futures</span>
<span class="sd">DEBUG:ibm_s3transfer.utils:Acquiring 0</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-call.s3.GetObject: calling handler &lt;function add_expect_header at 0x7fdbb95dc9d8&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;bound method S3RegionRedirector.redirect_from_cache of &lt;ibm_botocore.utils.S3RegionRedirector object at 0x7fdba829f278&gt;&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event choose-signer.s3.GetObject: calling handler &lt;function set_operation_specific_signer at 0x7fdbb95dc048&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event request-created.s3.GetObject: calling handler &lt;function signal_transferring at 0x7fdbb9387730&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:Executing task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=33554432-41943039&#39;}}) with kwargs {&#39;client&#39;: &lt;ibm_botocore.client.S3 object at 0x7fdba8283b38&gt;, &#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;fileobj&#39;: &lt;ibm_s3transfer.utils.DeferredOpenFile object at 0x7fdba82456d8&gt;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=33554432-41943039&#39;}, &#39;callbacks&#39;: [], &#39;max_attempts&#39;: 5, &#39;start_index&#39;: 33554432, &#39;download_output_manager&#39;: &lt;ibm_s3transfer.download.DownloadFilenameOutputManager object at 0x7fdba82454a8&gt;, &#39;io_chunksize&#39;: 262144, &#39;bandwidth_limiter&#39;: None}</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=41943040-50331647&#39;}}) about to wait for the following futures []</span>
<span class="sd">DEBUG:ibm_s3transfer.futures:Submitting task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=50331648-58720255&#39;}}) to executor &lt;ibm_s3transfer.futures.BoundedExecutor object at 0x7fdba829fc88&gt; for transfer request: 0.</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-call.s3.GetObject: calling handler &lt;bound method S3RegionRedirector.set_request_url of &lt;ibm_botocore.utils.S3RegionRedirector object at 0x7fdba829f278&gt;&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function generate_idempotent_uuid at 0x7fdbb95dc158&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function validate_bucket_name at 0x7fdbb95dc510&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;bound method S3RegionRedirector.redirect_from_cache of &lt;ibm_botocore.utils.S3RegionRedirector object at 0x7fdba829f278&gt;&gt;</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function sse_md5 at 0x7fdbb95dc598&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=41943040-50331647&#39;}}) done waiting for dependent futures</span>
<span class="sd">DEBUG:ibm_s3transfer.utils:Acquiring 0</span>
<span class="sd">DEBUG:ibm_botocore.endpoint:Making request for OperationModel(name=GetObject) with params: {&#39;url_path&#39;: &#39;/sql-query-cos-access-ts/jobid%3D29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;query_string&#39;: {}, &#39;method&#39;: &#39;GET&#39;, &#39;headers&#39;: {&#39;Range&#39;: &#39;bytes=8388608-16777215&#39;, &#39;User-Agent&#39;: &#39;ibm-cos-sdk-python/2.4.3 Python/3.6.9 Linux/4.4.0-174-generic ibm-cos-sdk-python-core/2.4.3&#39;}, &#39;body&#39;: b&#39;&#39;, &#39;url&#39;: &#39;https://s3.us-south.cloud-object-storage.appdomain.cloud/sql-query-cos-access-ts/jobid%3D29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;context&#39;: {&#39;client_region&#39;: &#39;us-east-1&#39;, &#39;client_config&#39;: &lt;ibm_botocore.config.Config object at 0x7fdba8283f28&gt;, &#39;has_streaming_input&#39;: False, &#39;auth_type&#39;: None, &#39;signing&#39;: {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;}}}</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-call.s3.GetObject: calling handler &lt;function add_expect_header at 0x7fdbb95dc9d8&gt;</span>
<span class="sd">DEBUG:ibm_botocore.endpoint:Sending http request: &lt;AWSPreparedRequest stream_output=True, method=GET, url=https://s3.us-south.cloud-object-storage.appdomain.cloud/sql-query-cos-access-ts/jobid%3D29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet, headers={&#39;Range&#39;: b&#39;bytes=0-8388607&#39;, &#39;User-Agent&#39;: b&#39;ibm-cos-sdk-python/2.4.3 Python/3.6.9 Linux/4.4.0-174-generic ibm-cos-sdk-python-core/2.4.3&#39;, &#39;Authorization&#39;: b&#39;Bearer eyJraWQiOiIyMDIwMDIyNTE4MjgiLCJhbGciOiJSUzI1NiJ9.eyJpYW1faWQiOiJJQk1pZC0yNzAwMDQwQjJRIiwiaWQiOiJJQk1pZC0yNzAwMDQwQjJRIiwicmVhbG1pZCI6IklCTWlkIiwiaWRlbnRpZmllciI6IjI3MDAwNDBCMlEiLCJnaXZlbl9uYW1lIjoiUmFnaHUiLCJmYW1pbHlfbmFtZSI6IkdhbnRpIiwibmFtZSI6IlJhZ2h1IEdhbnRpIiwiZW1haWwiOiJyZ2FudGlAdXMuaWJtLmNvbSIsInN1YiI6InJnYW50aUB1cy5pYm0uY29tIiwiYWNjb3VudCI6eyJ2YWxpZCI6dHJ1ZSwiYnNzIjoiNzY4NmZjYmI0MGYzODg3YmFiNzI1ZjhjNDI5MjhjMjMiLCJpbXNfdXNlcl9pZCI6IjcyMzQ5ODEiLCJpbXMiOiIxNzE2NTcxIn0sImlhdCI6MTU4NTE3NDU1MCwiZXhwIjoxNTg1MTc4MTUwLCJpc3MiOiJodHRwczovL2lhbS5uZy5ibHVlbWl4Lm5ldC9vaWRjL3Rva2VuIiwiZ3JhbnRfdHlwZSI6InVybjppYm06cGFyYW1zOm9hdXRoOmdyYW50LXR5cGU6YXBpa2V5Iiwic2NvcGUiOiJpYm0gb3BlbmlkIiwiY2xpZW50X2lkIjoiYngiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.aH3thJ5MHMg_mELog79yoanjFddFz2D0YV2hmEgutZo_DgySwRJ_VHlDepAhcywlhC1_CFaEy4CQeZOcf9NHYhGfj9rxQkB6LqO-1T5Sljzl-l-HEUb2O_RuPaDmSI9thOscF8wDjyhv_nJTkFfOtHrHQQ_9hbkUg2PGnmbGJwgd4qjIEKJ0-pzHmhjC2kRuwZt4gTE6xsZJf_JYnWBUXTW3X6uLfF0k1G2INJFwL25gw_XamQfx4-lccJ_eUIESvYNg5jCWI9ymrmfFVodxFy_sFhgBPOhktid95FFu38ioeQLBnuFeLWyr6v9QVjtkMq2FGuuF33HpdYYsQVmAoQ&#39;}&gt;</span>
<span class="sd">DEBUG:urllib3.util.retry:Converted retries value: False -&gt; Retry(total=False, connect=None, read=None, redirect=0, status=None)</span>
<span class="sd">DEBUG:ibm_botocore.hooks:Event before-parameter-build.s3.GetObject: calling handler &lt;function validate_bucket_name at 0x7fdbb95dc510&gt;</span>
<span class="sd">DEBUG:ibm_s3transfer.tasks:Executing task GetObjectTask(transfer_id=0, {&#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=41943040-50331647&#39;}}) with kwargs {&#39;client&#39;: &lt;ibm_botocore.client.S3 object at 0x7fdba8283b38&gt;, &#39;bucket&#39;: &#39;sql-query-cos-access-ts&#39;, &#39;key&#39;: &#39;jobid=29d6ff44-fb0d-4a16-95e7-3235b0b0dd56/part-00000-d1f439ae-1541-4fad-a140-7fe5cfa74d6b-c000-attempt_20200325221837_5154_m_000000_0.snappy.parquet&#39;, &#39;fileobj&#39;: &lt;ibm_s3transfer.utils.DeferredOpenFile object at 0x7fdba82456d8&gt;, &#39;extra_args&#39;: {&#39;Range&#39;: &#39;bytes=41943040-50331647&#39;}, &#39;callbacks&#39;: [], &#39;max_attempts&#39;: 5, &#39;start_index&#39;: 41943040, &#39;download_output_manager&#39;: &lt;ibm_s3transfer.download.DownloadFilenameOutputManager object at 0x7fdba82454a8&gt;, &#39;io_chunksize&#39;: 262144, &#39;bandwidth_limiter&#39;: None}</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="test_run"><a class="viewcode-back" href="../../cloud_utilities.html#cloud_utilities.sql_query.test_run">[docs]</a><span class="k">def</span> <span class="nf">test_run</span><span class="p">():</span>
    <span class="n">sqlClient</span> <span class="o">=</span> <span class="n">SQLClient</span><span class="p">()</span>
    <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">     WITH</span>
<span class="s2">        hourly_avg_table as (</span>
<span class="s2">            SELECT</span>
<span class="s2">                location,</span>
<span class="s2">                TS_SEG_AVG(TS_SEGMENT_BY_TIME(pm, 3600000, 3600000)) as hourly_avg_pm_ts,</span>
<span class="s2">                TS_SEG_AVG(TS_SEGMENT_BY_TIME(pm, hour , hour)) as hourly_avg_pm_ts_2</span>
<span class="s2">                TS_SEG_AVG(TS_SEGMENT_BY_TIME(pm, hour , hour)) as hourly_avg_pm_ts_2</span>
<span class="s2">                TS_SEG_AVG(TS_SEGMENT_BY_TIME(pm, hour , 3600000)) as hourly_avg_pm_ts_2</span>
<span class="s2">            FROM cos://s3.us-south.cloud-object-storage.appdomain.cloud/tuan-sql-result/jobid=f6cee0f2-5524-43cd-8aee-ddc3c428868f STORED AS PARQUET)</span>
<span class="s2">    SELECT</span>
<span class="s2">        location,</span>
<span class="s2">        TS_FILLNA(hourly_avg_pm_ts, TS_INTERPOLATOR_LINEAR(0.0,1,1)) as hourly_avg_pm_ts</span>
<span class="s2">    FROM hourly_avg_table</span>
<span class="s2">    INTO cos://us-south/tuan-sql-result STORED AS PARQUET</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">sqlClient</span><span class="o">.</span><span class="n">_sql_stmt</span> <span class="o">=</span> <span class="n">sql_stmt</span>
    <span class="n">sqlClient</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">sqlClient</span> <span class="o">=</span> <span class="n">SQLClient</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
    <span class="c1"># sqlClient.get_catalog_table_partitioned(&quot;employees_partitioned&quot;)</span>
    <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM aiops_march102020 LIMIT 10</span>
<span class="s2">    INTO cos://us-south/sql-query-cos-access-ts STORED AS PARQUET</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="c1"># sqlClient.submit_sql(sql_stmt, pagesize=100)</span>

    <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM aiops_march102020 LIMIT 10</span>
<span class="s2">    INTO</span>
<span class="s2">        cos://us-south/sql-query-cos-access-ts STORED AS PARQUET</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="c1"># submit_sql_with_checking_saved_jobs(sql_stmt, pagesize=100)</span>

    <span class="n">sql_stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT *,</span>
<span class="s2">	date_format(from_unixtime(_source._ts / 1000, &#39;yyyy-MM-dd HH:mm:ss&#39;), &#39;yyyy&#39;) AS _year,</span>
<span class="s2">	date_format(from_unixtime(_source._ts / 1000, &#39;yyyy-MM-dd HH:mm:ss&#39;), &#39;D&#39;) AS _dayofyear,</span>
<span class="s2">	date_format(from_unixtime(_source._ts / 1000, &#39;yyyy-MM-dd HH:mm:ss&#39;), &#39;HH&#39;) AS _hour</span>
<span class="s2">    FROM cos://us-south/access-cos-standard-6il/a2bea9c45b.2019-11-19.76.ld76.json.gz STORED AS JSON INTO cos://us-south/cos-standard-6il/a2bea9c45b.2019-11-19.76.ld76.json.gz STORED AS JSON PARTITIONED BY (_year, _dayofyear, _hour)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="c1"># print(sql_stmt)</span>
    <span class="c1"># submit_sql_with_checking_saved_jobs(sql_stmt, pagesize=100)</span>
</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2020, IBM Research.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>